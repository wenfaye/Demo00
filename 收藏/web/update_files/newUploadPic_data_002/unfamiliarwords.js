AP.widget.unfamiliarWords=new AP.Class({setOptions:function(a){return AP.hashExtend({selectWordEvent:function(){},offset:[0,0],class_name:"unfamiliarTag"},a||{})},initialize:function(a,b){a.forEach(function(c){E.on(c,"click",this.onTargetClickEvent,c,this)},this);this.options=b||{};this.options=this.setOptions(this.options);this.offset=this.options.offset;this.selectWordEvent=new U.CustomEvent("selectWordEvent");this.selectWordEvent.subscribe(this.options.selectEvent,this,true);this.display()},display:function(){var b=this.buildDom();var a=this.getSpellElements();var d=this.getWordsElement();this.container=b;this.setSpellSelected();var c=window.cache.unfamiliarWords.a.split("");this.bodyClick();this.innerWords(c)},setSpellSelected:function(a){spells.forEach(function(b){D.removeClass(b,"selected")},this);if(!a){D.addClass(spells[0],"selected")}else{D.addClass(a,"selected")}},innerWords:function(b){var d=this.getWordsElement();var a="";b.forEach(function(c){a+=this.buildWordDom(c)},this);d.innerHTML=a;this.getWordElements();this.createIframe()},createIframe:function(){var b=D.getRegion(this.container);if(D.query(".unfamiliar-iframe").length){var a=D.query(".unfamiliar-iframe")[0];if(D.hasClass(this.container,"fn-hide")){D.addClass(a,"fn-hide")}else{D.removeClass(a,"fn-hide")}}else{var a=Element.create("iframe",{"class":"unfamiliar-iframe"});D.addClass(a,"fn-hide");a.setAttribute("frameborder","0");a.setAttribute("scrolling","no");a.setAttribute("src",'javascript:""');document.body.appendChild(a)}D.setStyles(a,{"z-index":"699",width:b.right-b.left-2+"px",height:b.bottom-b.top-2+"px",position:"absolute",left:b.left+"px",top:b.top+"px"})},bodyClick:function(){E.on(document.body,"click",function(c){if(D.hasClass(this.container,"fn-hide")){return}var b=E.getTarget(c);var a=false;D.query("*",this.container).forEach(function(d){if(b==d){a=true;return}});if(b!=this.current_target&&b!=this.container&&!a){if(!D.hasClass(b,this.options.class_name)){this.hide()}}},"",this)},hide:function(){D.addClass(this.container,"fn-hide");if(D.query(".unfamiliar-iframe").length){D.addClass(D.query(".unfamiliar-iframe")[0],"fn-hide")}},onTargetClickEvent:function(b,a){this.current_target=a;D.removeClass(this.container,"fn-hide");this.setPostion(a);this.createIframe();E.preventDefault(b)},setPostion:function(b){var a=D.getRegion(b);D.setStyles(this.container,{position:"absolute"});if(this.offset){D.setXY(this.container,[a.left+this.offset[0],a.bottom+this.offset[1]])}else{D.setXY(this.container,[a.left,a.bottom])}if(D.query(".unfamiliar-iframe").length){D.removeClass(D.query(".unfamiliar-iframe")[0],"fn-hide")}},onSpellOverEvent:function(b,a){try{var c=window.cache.unfamiliarWords[a.title].split("")}catch(b){var c=[]}this.setSpellSelected(a);this.innerWords(c)},onWordClickEvent:function(b,a){if(!D.hasClass(this.container,"fn-hide")){if(D.query(".unfamiliar-iframe").length){D.addClass(D.query(".unfamiliar-iframe")[0],"fn-hide")}}this.selectWordEvent.fire(a,this.container,this);E.preventDefault(b)},getSpellElements:function(){spells=D.query(".unfamiliar-spell",this.container);spells.forEach(function(a){E.on(a,"mouseover",this.onSpellOverEvent,a,this)},this);return spells},getWordElements:function(){var a=D.query(".unfamiliar-word",this.container);a.forEach(function(b){E.on(b,"click",this.onWordClickEvent,b,this)},this);return a},getWordsElement:function(){return D.query(".unfamiliar-words",this.container)[0]},getWordsElementC:function(){return D.query(".unfamiliar-words-hide",this.container)[0]},buildDom:function(){if(D.query(".unfamiliar").length){var c=D.query(".unfamiliar")[0]}else{var c=Element.create("div",{"class":"unfamiliar fn-hide"});var a=this.buildSpellDom();var b=this.buildWordsDom();c.innerHTML=a+b;D.setStyles(c,{width:"500px","z-index":"700"});document.body.appendChild(c)}return c},buildSpellDom:function(){var c='<div class="unfamiliar-spells">';for(var b=97;b<=122;b++){var a=String.fromCharCode(b);if(b==99){a=a+"[ch]"}else{if(b==115){a=a+"[sh]"}else{if(b==122){a=a+"[zh]"}}}c+='<a href="#" class="unfamiliar-spell" title="'+String.fromCharCode(b)+'">'+a+"</a>"}c+="</div>";return c},buildWordsDom:function(){var a='<div class="unfamiliar-words"></div>';return a},buildWordDom:function(b){var a='<a href="#" class="unfamiliar-word" style="z-index:10;">'+b+"</a>";return a}});