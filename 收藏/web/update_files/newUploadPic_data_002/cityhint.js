if(!window.cache){window.cache={}}window.cache.cityHintSpec=window.cache.cityHintSpecOverride?window.cache.cityHintSpecOverride:["北京","上海","重庆","天津","重庆"];window.cache.cityHintNoSub=["香港特别行政区","澳门特别行政区","台湾省","其他国家和地区"];window.cache.cityHintArea={"华北":["北京市","天津市","河北省","山西省","内蒙古自治区"],"东北":["辽宁省","吉林省","黑龙江省"],"华东":["上海市","江苏省","浙江省","安徽省","福建省","江西省","山东省"],"中南":["河南省","湖北省","湖南省","广东省","海南省","广西壮族自治区"],"西南":["重庆市","四川省","贵州省","云南省","西藏自治区"],"西北":["陕西省","甘肃省","青海省","宁夏回族自治区","新疆维吾尔自治区"],"港澳台":["香港特别行政区","澳门特别行政区","台湾省","其他国家和地区"]};if(!window.cache.cityHintAreaNoUnit){window.cache.cityHintAreaNoUnit={"华北":["北京","天津","河北","山西","内蒙古自治区"],"东北":["辽宁","吉林","黑龙江"],"华东":["上海","江苏","浙江","安徽","福建","江西","山东"],"中南":["河南","湖北","湖南","广东","海南","广西壮族自治区"],"西南":["重庆","四川","贵州","云南","西藏自治区"],"西北":["陕西","甘肃","青海","宁夏回族自治区","新疆维吾尔自治区"],"港澳台":["香港特别行政区","澳门特别行政区","台湾","其他国家和地区"]}}AP.widget.cityHint=function(l){var n=this,c,j,g=[],i={key:"cityhint",provId:"prov-input",cityId:"city-input",subId:"district-input",zipId:"zip-input",errorEl:"",setPosition:null,units:true,onProvSelect:null,onCitySelect:null,onDistrictSelect:null,onHideEvent:function(){}};this.cache=[];this.cache[0]=D.get(i.provId)?D.get(i.provId).value:"";this.cache[1]=D.get(i.cityId)?D.get(i.cityId).value:"";this.cache[2]=D.get(i.subId)?D.get(i.subId).value:"";if(l){L.augmentObject(i,l,true)}function p(){if(this.cache[0].length>0&&this.cache[1].length>0){D.get(i.triggle[0]).innerHTML=window.cache.cityHintSpec.has(this.cache[0])?this.cache[1]:this.cache[0]+""+this.cache[1]}if(D.get(i.triggle[1])&&this.cache[2].length>0){D.get(i.triggle[1]).innerHTML=this.cache[2]}}function e(){var w=i.units?window.cache.cityHintArea:window.cache.cityHintAreaNoUnit;var y='<span class="close"> </span>';for(var x in w){var v='<dl class="fn-clear"><dt>'+x+"</dt><dd>";var u=true;w[x].forEach(function(z,B){var A=z.replace("市","");if(window.cache.cityHintProv.hasOwnProperty(A)){u=false;v+='<a href="javascript:void(0)" title="'+A+'" attr="prov">'+z+"</a>"}});v+="</dd></dl>";if(!u){y+=v}}if(!D.get(i.key+"-main")){Element.create("div",{id:i.key+"-main",className:"cityhint",innerHTML:y,style:{display:"none"},appendTo:document.body})}else{D.get(i.key+"-main").innerHTML=y}Element.create("div",{id:i.key+"-sub",className:"cityhint cityhint-sub",style:{display:"none"},appendTo:document.body});if(D.get(i.key+"-district-select")){var t="";if(window.cache.cityHintNoSub.has(D.get(i.provId).value)){t="none"}D.get(i.key+"-district-select").style.display=t}}function b(v,u){var t=D.get(i.key+"-main");if(!t){E.stopEvent(v)}k("district",false);k("sub",false);t.style.display=u===false?"none":"block";if(false!==u){a(v,t);s(t);f(i.provId,t)}else{o(t);i.onHideEvent.apply(n,n.cache)}E.stopEvent(v)}function k(t,v,w){var u=D.get(i.key+"-"+t);if(!u){return}if(v===false){D.get(i.key+"-sub").style.display="none";o(u)}u.style.display=v===false?"none":"block";if((false!==v)&&w){a(w,u)}f(i.cityId,u);if(w){E.preventDefault(w)}}function d(t){n.cache[1]=this.getAttribute("attr");m(n.cache[0],this.title,"","");D.get(i.key+"-city-select").innerHTML=window.cache.cityHintSpec.concat(window.cache.cityHintNoSub).has(n.cache[0])?this.title:n.cache[0]+""+this.title;if(i.onCitySelect){i.onCitySelect.call(n,n.cache[1])}var u=D.get(i.key+"-district-select");if(u){u.innerHTML="请选择区县";u.style.display=n.cache[1]&&window.cache.cityHintCity.hasOwnProperty(n.cache[1])?"":"none"}if(!window.cache.cityHintCity.hasOwnProperty(n.cache[1])){if(D.get(i.subId)){D.get(i.subId).value="　"}}k("sub",false,t);b("",false);o(D.get(i.key+"-district"));i.onHideEvent.apply(n,n.cache);if(u&&window.cache.cityHintCity[n.cache[1]]){q(t,n);a(t,D.get(i.key+"-district"),u);s(D.get(i.key+"-district"))}E.stopEvent(t)}function h(x){var t=this.innerHTML,u=D.query("a.current",D.get(i.key+"-main")),y="";n.cache[0]=t.replace("市","");if(u.length>0){D.removeClass(u,"current")}D.addClass(this,"current");var w=window.cache.cityHintProv[n.cache[0]].length>0?window.cache.cityHintProv[n.cache[0]][0]:"";if(window.cache.cityHintSpec.concat(window.cache.cityHintNoSub).has(n.cache[0])){m(n.cache[0],t,"","")}else{m(n.cache[0],w,"","")}if(!window.cache.cityHintSpec.has(n.cache[0])&&!window.cache.cityHintNoSub.has(n.cache[0])){y=n.cache[0];r(x,n.cache[0]);o(D.get(i.key+"-sub"));s(D.get(i.key+"-sub"))}else{n.cache[1]=t;b("",false);y=window.cache.cityHintSpec.has(n.cache[0])?this.title:window.cache.cityHintNoSub.has(n.cache[0])?n.cache[0]:n.cache[0]+""+this.title;if(window.cache.cityHintSpec.has(n.cache[0])){q(x,n);a(x,D.get(i.key+"-district"),D.get(i.key+"-district-select"));s(D.get(i.key+"-district"))}else{if(window.cache.cityHintNoSub.has(n.cache[0])){if(D.get(i.key+"-district-select")){D.get(i.key+"-district-select").style.display="none"}}}}D.get(i.key+"-city-select").innerHTML=y+w;n.cache[1]=w;if(window.cache.cityHintProv.hasOwnProperty(n.cache[0])&&window.cache.cityHintProv[n.cache[0]].length>0&&D.get(i.key+"-district-select")){D.get(i.key+"-district-select").style.display="";D.get(i.key+"-district-select").innerHTML="请选择区县"}else{if(D.get(i.key+"-district-select")){D.get(i.key+"-district-select").style.display="none"}}if(i.onProvSelect){i.onProvSelect.call(n,y)}if(window.cache.cityHintSpec.has(y)&&i.onCitySelect){i.onCitySelect.call(n,y)}E.preventDefault(x)}function r(v,y){var u=i.key+"-sub",t='<span class="close"> </span><div>',w=window.cache.cityHintProv[y];if(w&&w.length>0){var x=D.getRegion(E.getTarget(v));w.forEach(function(z){t+="<a href='javascript:void(0)' title='"+z.split("-")[0]+"' attr='"+z.split("-")[0]+"'>"+z.split("-")[0].replace("市","")+"</a>"});t+="</div>";if(!D.get(u)){Element.create("div",{id:u,className:"sub fn-clear",innerHTML:t,style:{display:"none"},appendTo:D.get(i.key+"-main")})}else{D.get(u).style.display="none";D.get(u).innerHTML=t}k("sub",true);a(v,u);E.on(D.query("div a",D.get(u)),"click",d);E.on(D.query("span.close",D.get(u))[0],"click",function(z){k("sub",false);o(D.get(i.key+"-sub"));E.stopEvent(z)},false)}else{b("",false);m(y,y,"","");D.get(i.key+"-city-select").innerHTML=y}}function q(y,x){if(D.get(i.provId).value==""||D.get(i.cityId).value==""){D.addClass(E.getTarget(y).parentNode,"fm-error");var t=D.query("div.fm-explain",E.getTarget(y).parentNode);if(t.length<1){Element.create("div",{"class":"fm-explain",innerHTML:"请选择城市",appendTo:E.getTarget(y).parentNode})}else{D.removeClass(t[0],"fn-hide");t[0].innerHTML="请选择城市"}E.preventDefault(y);return false}var u=[[],[],[]],w=window.cache.cityHintCity&&window.cache.cityHintCity[n.cache[1]]||[],v=i.key+"-district";str='<span class="close"> </span>';w.forEach(function(z){if(z.indexOf("区-")>-1){u[0].push(z)}else{if(z.indexOf("市-")>-1){u[1].push(z)}else{if(z.indexOf("县-")>-1){u[2].push(z)}else{if(z.split("-")[1]!==""){u[2].push(z)}}}}});u.forEach(function(B,A){var z=false;if(B.length>0){str+='<dl class="fn-clear"><dt>';str+=(A===0?"城区":A===1?"县级市":A===2?"县":"");str+="</dt><dd>";B.forEach(function(C){if(C.split("-")[0]!=="其他区"){str+='<a href="javascript:void(0)" title="'+C.split("-")[0]+'" attr="'+C.split("-")[1]+'">'+C.split("-")[0]+"</a>"}else{z=true}});if(z){str+='<a href="javascript:void(0)" attr="">其他区</a>'}str+="</dd></dl>"}});str+="</dl>";if(!D.get(v)){Element.create("div",{id:v,className:"cityhint cityhint-district",innerHTML:str,appendTo:document.body})}else{D.get(v).innerHTML=str}b("",false);k("sub",false);if(D.get(i.key+"-district-select")){D.get(i.key+"-district-select").style.display="";k("district",true,y);f(i.subId,D.get(v))}if(x=="render"){s(D.get(v))}E.on(D.query("span.close",D.get(v))[0],"click",function(z){b("",false);k("district",false,z);o(D.get(v))},false);E.on(D.query("dd a",D.get(v)),"click",function(z){D.get(i.subId).value=this.innerHTML;D.get(i.key+"-district-select").innerHTML=this.innerHTML;D.get(i.zipId).value=this.getAttribute("attr");k("district",false,z);if(i.onDistrictSelect){i.onDistrictSelect.call(n,this.innerHTML)}E.preventDefault(z)});E.stopEvent(y)}function a(A,u,z){var z=z||E.getTarget(A);var F=D.getXY(z);if(!u){return}if(typeof u!=="object"){u=D.get(u)}if(i.setPosition){i.setPosition.call(n,A,u,z)}else{if(z.getAttribute("attr")==="prov"){var J=D.get(i.key+"-main"),H=D.getXY(J),t=u.offsetWidth,G=u.offsetHeight,C=z.offsetWidth,w=z.offsetHeight,v={left:F[0]-H[0],top:F[1]-H[1],right:J.offsetWidth-F[0]-C,bottom:J.offsetHeight-(F[1]-H[1])-w},I,B;if(v.right<=u.offsetWidth){I=F[0]-(t-C)}else{I=F[0]}if(v.bottom>v.top&&v.bottom-G>-10){B=F[1]+w}else{B=F[1]-G}D.setXY(u,[I,B]);if(u){D.setXY(D.get(u.id+"-overlay"),[F[0],F[1]+z.offsetHeight])}}else{D.setXY(u,[F[0],F[1]+z.offsetHeight])}}}function s(u){if(!u||!D.getXY(u)){return}if(D.get(i.key+"-overlay")){return}if(!D.get(u.id+"-overlay")){Element.create("div",{id:u.id+"-overlay",className:"cityhint-overlay",innerHTML:'<iframe src="https://img.alipay.com/global/blank.html" style="width: 100%; height: 100%"></iframe>',appendTo:document.body})}else{}var t=AP.env.browser.msie;D.setStyles(D.get(u.id+"-overlay"),{padding:"0",left:D.getXY(u)[0]-(t?10:10)+"px",top:D.getXY(u)[1]-(t?0:0)+"px",width:u.offsetWidth-30+"px",height:u.offsetHeight-20+"px"})}function o(t){if(!t){return false}var u=D.get(t.id+"-overlay")||false;if(t.id&&u){u.parentNode.removeChild(u)}else{if(t=="all"){D.query(".cityhint-overlay").forEach(function(v){v.parentNode.removeChild(v)})}}}function m(t,w,v,u){if(D.get(i.provId)&&t!==false){n.cache[0]=t;D.get(i.provId).value=t}if(D.get(i.cityId)&&w!==false){D.get(i.cityId).value=w}if(D.get(i.subId)&&v!==false){D.get(i.subId).value=v}if(i.errorEl!==""&&D.get(i.errorEl)){j=D.get(i.errorEl)}else{if(D.hasClass(D.get(i.provId).parentNode,"fm-error")){j=D.query(".fm-explain",D.get(i.provId).parentNode)[0]}}D.addClass(j,"fn-hide");D.removeClass(D.get(i.provId).parentNode,"fm-error");if(D.get(i.zipId)&&u!==false){D.get(i.zipId).value=u;if(D.hasClass(D.get(i.zipId).parentNode,"fm-error")){D.removeClass(D.get(i.zipId).parentNode,"fm-error")}}}function f(u,t){var v=D.query("a[title='"+D.get(u).value+"']",t);if(v.length>0&&v[0].title){D.removeClass(D.query("a.current",t),"current");D.addClass(v,"current")}}this.setCfg=function(u,t){i[u]=t};this.getCfg=function(){return i};this.setData=function(t){if(t.prov){delete window.cache.cityHintProv;window.cache.cityHintProv=t.prov}if(t.city){delete window.cache.cityHintCity;window.cache.cityHintCity=t.city}};this.hide=function(){if(D.get(i.key+"-main")){D.get(i.key+"-main").style.display="none"}if(D.get(i.key+"-sub")){D.get(i.key+"-sub").style.display="none"}if(D.get(i.key+"-district")){D.get(i.key+"-district").style.display="none"}o("all");i.onHideEvent.apply(n,n.cache)};this.render=function(){E.onDOMReady(function(){p.call(n);e.call(n);var t=D.query("#"+i.key+"-main dd a"),u=D.query("#"+i.key+"-main .close")[0];E.on(i.triggle[0],"click",b);E.on(u,"click",b,false);E.on(t,"click",h);E.on(i.triggle[1],"click",q,"render",n);E.on(document.body,"click",function(v){if(!AP.fn.eInRegion(D.getRegion(i.key+"-main"),v)&&!AP.fn.eInRegion(D.getRegion(i.key+"-sub"),v)&&!AP.fn.eInRegion(D.getRegion(i.key+"-district"),v)){n.hide()}})})}};