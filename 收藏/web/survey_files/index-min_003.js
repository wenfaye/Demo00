//! Copyright 2015, overlay@0.0.4 MIT Licensed, build time: Mon, 08 Jun 2015 09:37:21 GMT 
define("kg/overlay/0.0.4/index",["node","ua","util","kg/xtemplate/4.1.4/runtime","kg/component/0.0.2/container","kg/component/0.0.2/extension/shim","kg/component/0.0.2/extension/align","kg/component/0.0.2/extension/content-box"],function(e,t,n){var a,o,i,s,r,l,c,d,u,f,v,p=e("node"),h=e("ua"),g=e("util"),m=e("kg/xtemplate/4.1.4/runtime"),y=e("kg/component/0.0.2/container"),x=e("kg/component/0.0.2/extension/shim"),b=e("kg/component/0.0.2/extension/align"),C=e("kg/component/0.0.2/extension/content-box");a=function(e){function t(){}var n=p;return t.prototype={loading:function(){var e=this;e._loadingExtEl||(e._loadingExtEl=n('<div class="'+e.get("prefixCls")+'ext-loading" style="position: absolute;border: none;width: 100%;top: 0;left: 0;z-index: 99999;height:100%;*height: expression(this.parentNode.offsetHeight);"/>').appendTo(e.$el)),e._loadingExtEl.show()},unloading:function(){this._loadingExtEl&&this._loadingExtEl.hide()}},e=t}(),o=function(e){function t(){return c?"expression(KISSY.DOM.docWidth())":"100%"}function n(){return c?"expression(KISSY.DOM.docHeight())":"100%"}function a(e,a){var o=e.getBaseCssClasses("mask"),i=d('<div  style="width:'+t()+";left:0;top:0;height:"+n()+";position:"+(c?"absolute":"fixed")+';" class="'+o+" "+a+'">'+(c?'<iframe style="position:absolute;left:0;top:0;background:red;width: expression(this.parentNode.offsetWidth);height: expression(this.parentNode.offsetHeight);filter:alpha(opacity=0);z-index:-1;"></iframe>':"")+"</div>").prependTo("body");return i.unselectable(),i.on("mousedown",function(e){e.preventDefault()}),i}function o(){}function i(e,t){var n=e.get("maskNode"),a=e.getBaseCssClasses("mask-hidden");t?n.removeClass(a):n.addClass(a)}function s(e,t,n,a){var o=e.effect||u;if(i(a,n),o!==u){var s,r=e.duration,l=e.easing,c=n?1:0;t.stop(1,1),t.css("display",n?u:"block"),s=o+f[o][c],t[s](r,function(){t.css("display","")},l)}}function r(e){var t,n=this,a=n.get("maskNode");if(t=e.newVal){var o=Number(n.$el.css("z-index"));isNaN(o)||a.css("z-index",o)}s(n.get("mask"),a,t,n)}var l=h,c=6===l.ie,d=p;o.ATTRS={mask:{value:!1},maskNode:{}};var u="none",f={fade:["Out","In"],slide:["Up","Down"]};return o.prototype={__renderUI:function(){var e=this;e.get("mask")&&e.set("maskNode",a(e,e.get("visible")?"":e.getBaseCssClasses("mask-hidden")))},__bindUI:function(){var e,t,n=this;(t=n.get("mask"))&&(e=n.get("maskNode"),t.closeOnClick&&e.on("tap",n.close,n),n.on("afterVisibleChange",r))},__destructor:function(){var e;(e=this.get("maskNode"))&&e.remove()}},e=o}(),i=function(e){function t(e){var t=e.$el,n=t.clone(!0);return n.css({visibility:"hidden",overflow:"hidden"}).addClass(e.get("prefixCls")+"overlay-ghost"),e.__afterCreateEffectGhost(n)}function n(e,n){e.__effectGhost&&e.__effectGhost.stop(1,1);var a,o,i,s,l=e.$el,c=p,d=e.get("effect"),u=c(d.target),f=d.duration,v={width:u.width(),height:u.height()},h=u.offset(),g={width:l.width(),height:l.height()},m=l.offset(),y=t(e),x=d.easing;y.insertAfter(l),n?(a=v,i=h,o=g,s=m):(a=g,i=m,o=v,s=h),y.offset(s),r.mix(o,{left:y.css("left"),top:y.css("top")}),l.css("visibility","hidden"),y.css(a),y.offset(i),e.__effectGhost=y,y.css("visibility","visible"),y.animate(o,{Anim:d.Anim,duration:f,easing:x,complete:function(){e.__effectGhost=null,y.remove(),l.css("visibility","")}})}function a(e,t){var a=e.$el,o=e.get("effect"),i=o.effect||"none",r=o.target;if("none"!==i||r){if(r)return n(e,t),void 0;var l=o.duration,c=o.easing,d=t?1:0;a.stop(1,1),a.css({visibility:"visible",display:t?"none":"block"});var u=i+s[i][d];a[u]({duration:l,Anim:o.Anim,complete:function(){a.css({display:"block",visibility:""})},easing:c})}}function o(e){a(this,e.newVal)}function i(){}var s={fade:["Out","In"],slide:["Up","Down"]},r=g;return i.ATTRS={effect:{valueFn:function(){return{effect:"",target:null,duration:.5,easing:"easeOut"}},setter:function(e){var t=e.effect;"string"!=typeof t||s[t]||(e.effect="")}}},i.prototype={__afterCreateEffectGhost:function(e){return e},__bindUI:function(){this.on("afterVisibleChange",o,this)}},e=i}(),s=function(e){var t=e=function(){function e(e,t,n){var i=e.data,s=e.affix;t.data+='\n        <a href="javascript:void(\'close\')"\n           aria-label="Close"\n           class="',l.line=5;var r;r=u(o,e,{escape:1,params:["close"]},t,["getBaseCssClasses"]),t=t.writeEscaped(r),t.data+="\"\n           role='button'>\n            <span class=\"",l.line=7;var c;c=u(o,e,{escape:1,params:["close-x"]},t,["getBaseCssClasses"]),t=t.writeEscaped(c),t.data+='">';var d=(a=s.closeText)!==n?a:(a=i.closeText)!==n?a:e.resolveLooseUp(["closeText"]);return t=t.write(d),t.data+="</span>\n        </a>\n    ",t}function t(t,n,i){var s=t.data,r=t.affix;n.data+="\n    ",l.line=2,l.line=2;var c=(a=r.closable)!==i?a:(a=s.closable)!==i?a:t.resolveLooseUp(["closable"]);return n=f.call(o,t,{params:[c],fn:e},n),n.data+="\n",n}function n(e,t,n){var o=e.data,i=e.affix;t.data+="\n        ",l.line=14;var s=(a=i.content)!==n?a:(a=o.content)!==n?a:e.resolveLooseUp(["content"]);return t=t.write(s),t.data+="\n    ",t}{var a,o=this,i=o.root,s=o.buffer,r=o.scope,l=(o.runtime,o.name,o.pos),c=(r.data,r.affix,i.nativeCommands),d=i.utils,u=d.callFn,f=(d.callCommand,c.range,c.foreach,c.forin,c.each,c["with"],c["if"]),v=(c.set,c.include,c.parse,c.extend,c.block);c.macro,c["debugger"]}s.data+="",l.line=1,s=v.call(o,r,{params:["ks-overlay-closable"],fn:t},s),s.data+='\n\n<div class="',l.line=12;var p;return p=u(o,r,{escape:1,params:["content"]},s,["getBaseCssClasses"]),s=s.writeEscaped(p),s.data+='">\n    ',l.line=13,s=v.call(o,r,{params:["ks-overlay-content"],fn:n},s),s.data+="\n</div>",s};return t.TPL_NAME=n.id||n.name,e}(),r=function(e){var t=e=function(){function e(e,t,n){var a=e.data,i=e.affix;t.data+="\n ",u.line=6;var s=(o=i.xindex)!==n?o:(o=a.xindex)!==n?o:e.resolveLooseUp(["xindex"]);t=t.writeEscaped(s),t.data+=":";var r=a;return t=t.writeEscaped(r),t.data+=";\n",t}function t(e,t,n){var a=e.data,i=e.affix;t.data+="\n ",u.line=13;var s=(o=i.xindex)!==n?o:(o=a.xindex)!==n?o:e.resolveLooseUp(["xindex"]);t=t.writeEscaped(s),t.data+=":";var r=a;return t=t.writeEscaped(r),t.data+=";\n",t}function n(e,t,n){var a=e.data,i=e.affix;t.data+="\n ",u.line=20;var s=(o=i.xindex)!==n?o:(o=a.xindex)!==n?o:e.resolveLooseUp(["xindex"]);t=t.writeEscaped(s),t.data+=":";var r=a;return t=t.writeEscaped(r),t.data+=";\n",t}function a(a,s,r){var l=a.data,c=a.affix;s.data+='\n    <div class="',u.line=3;var d;d=p(i,a,{params:["header"]},s,["getBaseCssClasses"]);var f=d;s=s.writeEscaped(f),s.data+='"\n         style="\n',u.line=5,u.line=5;var v=(o=c.headerStyle)!==r?o:(o=l.headerStyle)!==r?o:a.resolveLooseUp(["headerStyle"]);s=h.call(i,a,{params:[v],fn:e},s),s.data+='\n">',u.line=8;var g=(o=c.headerContent)!==r?o:(o=l.headerContent)!==r?o:a.resolveLooseUp(["headerContent"]);s=s.write(g),s.data+='</div>\n\n    <div class="',u.line=10;var m;m=p(i,a,{params:["body"]},s,["getBaseCssClasses"]);var y=m;s=s.writeEscaped(y),s.data+='"\n         style="\n',u.line=12,u.line=12;var x=(o=c.bodyStyle)!==r?o:(o=l.bodyStyle)!==r?o:a.resolveLooseUp(["bodyStyle"]);s=h.call(i,a,{params:[x],fn:t},s),s.data+='\n">',u.line=15;var b=(o=c.bodyContent)!==r?o:(o=l.bodyContent)!==r?o:a.resolveLooseUp(["bodyContent"]);s=s.write(b),s.data+='</div>\n\n    <div class="',u.line=17;var C;C=p(i,a,{params:["footer"]},s,["getBaseCssClasses"]);var _=C;s=s.writeEscaped(_),s.data+='"\n         style="\n',u.line=19,u.line=19;var k=(o=c.footerStyle)!==r?o:(o=l.footerStyle)!==r?o:a.resolveLooseUp(["footerStyle"]);s=h.call(i,a,{params:[k],fn:n},s),s.data+='\n">',u.line=22;var w=(o=c.footerContent)!==r?o:(o=l.footerContent)!==r?o:a.resolveLooseUp(["footerContent"]);return s=s.write(w),s.data+='</div>\n    <div tabindex="0"></div>\n',s}{var o,i=this,r=i.root,l=i.buffer,c=i.scope,d=i.runtime,u=(i.name,i.pos),f=(c.data,c.affix,r.nativeCommands),v=r.utils,p=v.callFn,h=(v.callDataFn,v.callCommand,f.range,f.foreach,f.forin,f.each),g=(f["with"],f["if"],f.set,f.include,f.parse,f.extend,f.block);f.macro,f["debugger"]}l.data+="";var m;d.extendTpl={params:["./index"]},l=l.async(function(e){d.extendTplBuffer=e}),d.extendTplFn=s;var y=m;return l=l.write(y),l.data+="\n",u.line=2,l=g.call(i,c,{params:["ks-overlay-content"],fn:a},l),l.data+="\n",l};return t.TPL_NAME=n.id||n.name,e}(),l=function(e){var t=s,n=m,a=new n(t);return e=function(){return a.render.apply(a,arguments)}}(),c=function(e){var t=r,n=m,a=new n(t);return e=function(){return a.render.apply(a,arguments)}}(),d=function(e){var t=y,n=x,s=b,r=a,c=o,d=i,u=C,f=l,v="hide",p={hide:v,destroy:"destroy"};return e=t.extend([u,n,r,s,c,d],{bindUI:function(){var e=this,t=e.get("closeBtn");t&&t.on("click",function(t){e.close(),t.preventDefault()})},close:function(){var e=this;return e[p[e.get("closeAction")]||v](),e}},{ATTRS:{handleGestureEvents:{value:!1},focusable:{value:!1},allowTextSelection:{value:!0},contentTpl:{value:f},closable:{value:!1,sync:0,render:1,parse:function(){return!!this.get("closeBtn")}},closeBtn:{selector:function(){return"."+this.getBaseCssClass("close")}},closeAction:{value:v},closeText:{value:"close",render:1},visible:{value:!1}},xclass:"overlay"})}(),u=function(e){function t(e,t,n){t=e.get(t),t.html(n)}function n(e){var t=this,n=e.keyCode;if(n===l){var a=t.$el,o=i(e.target),s=a.last();if(o.equals(a)&&e.shiftKey)s[0].focus(),e.halt();else if(o.equals(s)&&!e.shiftKey)t.focus(),e.halt();else if(o.equals(a)||a.contains(o))return;e.halt()}}var a=g,o=d,i=p,s=c,r=o.extend({beforeCreateDom:function(e){a.mix(e.elAttrs,{role:"dialog","aria-labelledby":"ks-stdmod-header-"+this.get("id")})},getChildrenContainerEl:function(){return this.get("body")},__afterCreateEffectGhost:function(e){var t=this,n=t.get("body");return e.all("."+t.get("prefixCls")+"stdmod-body").css({height:n.height(),width:n.width()}).html(""),e},handleKeyDownInternal:function(e){return this.get("escapeToClose")&&e.keyCode===i.Event.KeyCode.ESC?(("select"!==e.target.nodeName.toLowerCase()||e.target.disabled)&&(this.close(),e.halt()),void 0):(n.call(this,e),void 0)},_onSetVisible:function(e,t){var n=this,a=n.el;if(n.callSuper(e,t),e)n.__lastActive=a.ownerDocument.activeElement,n.focus(),a.setAttribute("aria-hidden","false");else{a.setAttribute("aria-hidden","true");try{n.__lastActive&&n.__lastActive.focus()}catch(o){}}},_onSetBodyContent:function(e){t(this,"body",e)},_onSetHeaderContent:function(e){t(this,"header",e)},_onSetFooterContent:function(e){t(this,"footer",e)}},{ATTRS:{focusable:{value:!0},contentTpl:{value:s},header:{selector:function(){return"."+this.getBaseCssClass("header")}},body:{selector:function(){return"."+this.getBaseCssClass("body")}},footer:{selector:function(){return"."+this.getBaseCssClass("footer")}},bodyStyle:{sync:0},footerStyle:{render:1},headerStyle:{render:1},headerContent:{value:"",sync:0,render:1,parse:function(){return this.get("header").html()}},bodyContent:{value:"",sync:0,render:1,parse:function(){return this.get("body").html()}},footerContent:{value:"",sync:0,render:1,parse:function(){return this.get("footer").html()}},closable:{value:!0},escapeToClose:{value:!0}},xclass:"dialog"}),l=i.Event.KeyCode.TAB;return e=r}(),f=function(e){function t(){var e,t=this,o=t.get("trigger");t.__mouseEnterPopup=function(n){a.call(t),e=l.later(function(){i.call(t,n),e=void 0},1e3*t.get("mouseDelay"))},o.on("mouseenter",t.__mouseEnterPopup),t._mouseLeavePopup=function(){e&&(e.cancel(),e=void 0),n.call(t)},o.on("mouseleave",t._mouseLeavePopup)}function n(){var e=this,t=1e3*e.get("mouseDelay");e._hiddenTimer=l.later(function(){s.call(e)},t)}function a(){var e=this;e._hiddenTimer&&(e._hiddenTimer.cancel(),e._hiddenTimer=void 0)}function o(){var e=this;e.__clickPopup=function(t){t.preventDefault(),e.get("toggle")?(e.get("visible")?s:i).call(e,t):i.call(e,t)},e.get("trigger").on("click",e.__clickPopup)}function i(e){var t=this;t.set("currentTrigger",c(e.target)),t.show()}function s(){this.set("currentTrigger",void 0),this.hide()}var r=d,l=g,c=p;return e=r.extend({initializer:function(){var e=this,n=e.get("trigger");n&&("mouse"===e.get("triggerType")?t.call(e):o.call(e))},bindUI:function(){var e=this,t=e.get("trigger");t&&"mouse"===e.get("triggerType")&&e.$el.on("mouseleave",n,e).on("mouseenter",a,e)},destructor:function(){var e=this,t=e.$el,o=e.get("trigger");o&&(e.__clickPopup&&o.detach("click",e.__clickPopup),e.__mouseEnterPopup&&o.detach("mouseenter",e.__mouseEnterPopup),e._mouseLeavePopup&&o.detach("mouseleave",e._mouseLeavePopup)),t&&t.detach("mouseleave",n,e).detach("mouseenter",a,e)}},{ATTRS:{trigger:{setter:function(e){return c(e)}},triggerType:{value:"click"},currentTrigger:{},mouseDelay:{value:.1},toggle:{value:!1}},xclass:"popup"})}(),v=function(e){var t=d,n=u,a=f;return t.Dialog=n,t.Popup=a,e=t}(),n.exports=v});