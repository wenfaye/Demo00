define("io-form",["util","dom","querystring","io-base"],function(e){var r,t,a,n=e("util"),i=e("dom"),o=e("querystring"),u=e("io-base");return r=function(e){function r(e){return e.replace(d,"\r\n")}function t(e){for(var r=[],t=0;t<e.length;t++)r.push(e[t]);return r}var a,u=n,l=i,f=o,s=/^(?:select|textarea)/i,d=/\r?\n/g,m=/^(?:color|date|datetime|email|hidden|month|number|password|range|search|tel|text|time|url|week)$/i;return a={serialize:function(e,r){return f.stringify(a.getFormData(e),void 0,void 0,r||!1)},getFormData:function(e){var a=[],n={};return u.each(l.query(e),function(e){var r=e.elements?t(e.elements):[e];a.push.apply(a,r)}),a=u.filter(a,function(e){return e.name&&!e.disabled&&(e.checked||s.test(e.nodeName)||m.test(e.type))}),u.each(a,function(e){var t,a=l.val(e);if(null!==a){if(a=u.isArray(a)?u.map(a,r):r(a),t=n[e.name],void 0===t)return n[e.name]=a,void 0;u.isArray(t)||(t=n[e.name]=[t]),t.push.apply(t,u.makeArray(a))}}),n}},e=a}(),t=function(e){var t=n,a=u,l=i,f=o,s=r,d=window,m=Array.prototype.slice,c=d.FormData;return a.addPreprocessor("start",function(e){var r,a,n,i,o,u=e.io,d=u.config,y=d.form;if(y){r=l.get(y),o=d.data;for(var p=!1,v={},g=l.query("input",r),h=0,b=g.length;b>h;h++){var q=g[h];if("file"===q.type.toLowerCase()){if(p=!0,!c)break;var w=m.call(q.files,0);v[l.attr(q,"name")]=w.length>1?w:w[0]||null}}p&&c&&(d.files=d.files||{},t.mix(d.files,v),delete d.contentType),!p||c?(i=s.getFormData(r),d.hasContent?(i=f.stringify(i,void 0,void 0,d.serializeArray),o?d.data+="&"+i:d.data=i):t.mix(d.uri.query,i)):(n=d.dataType,a=n[0],"*"===a&&(a="text"),n.length=2,n[0]="iframe",n[1]=a)}}),e=s}(),a=function(e){return e=t}()});