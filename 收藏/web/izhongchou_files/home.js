/*
combined files : 

page/tpl/first-tpl
page/tpl/pre-tpl
page/tpl/hot-tpl
page/tpl/item-tpl
page/tpl/order-tpl
page/tpl/success-tpl
page/tpl/nav-tpl
page/home

*/
/**
 * Generated By grunt-kissy-template
 */
KISSY.add('page/tpl/first-tpl',function(){
    return {"html":"\n\n\n<div class=\"tab-content\">\n    {{#each items}}\n    <div class=\"tab-pannel\" data-color=\"{{color}}\">\n        <a href=\"{{link}}\" target=\"_blank\">\n            <img  src=\"{{pic}}_q90.jpg\" alt=\"\">\n        </a>\n    </div>\n    {{/each}}\n</div>"};
});
/**
 * Generated By grunt-kissy-template
 */
KISSY.add('page/tpl/pre-tpl',function(){
    return {"html":"\n\n\n{{#each(preData)}}\n    {{#if(xindex%2===0)}}\n        <div id=\"tab-content{{xindex}}\">\n            <ul class=\"tab-nav clearfix\"></ul>\n            <div class=\"tab-content\">\n    {{/if}}\n                <div class=\"tab-pannel\">\n                    <div class=\"item\">\n                        {{#if link}}\n                            <a href=\"{{link}}\" target=\"_blank\">\n                        {{else}}\n                            <a href=\"//izhongchou.taobao.com/dreamdetail.htm?id={{id}}\" target=\"_blank\">\n                        {{/if}}\n                            <img  src=\"{{image}}_300x300.jpg\" alt=\"淘宝众筹\">\n                        </a>\n                        <span class=\"status\">\n                            <span class=\"text\">上线日期</span>\n                            <span class=\"time\">{{plan_end_date}}</span>\n                        </span>\n                    </div>\n                </div>\n    {{#if((xindex+1)%2===0)}}\n            </div>\n        </div>\n    {{/if}}\n{{/each}}"};
});
/**
 * Generated By grunt-kissy-template
 */
KISSY.add('page/tpl/hot-tpl',function(){
    return {"html":"\n\n<div class=\"hot-tag\">\n    <span class=\"text\">大家都在看</span>\n    {{#each tags}}\n    <span class=\"tag tag-link\" data-spm-click=\"gostr=/wapsvip;locaid=d2{{xindex}}\">{{info}}</span>\n    {{/each}}\n</div>\n<div class=\"hot-main\">\n         <span class=\"l change J_hotSL hidden\">\n                    <b>&#xe614;</b>\n        </span>\n         <span class=\"r change J_hotSR hidden\">\n                    <b>&#xe60f;</b>\n        </span>\n\n    <div class=\"hot-ul-con\">\n\n        <div class=\"hot-scroll-con\" id=\"J_hotScroll\">\n            <ul class=\"tab-nav clearfix\"></ul>\n            <ul class=\"tab-content hot-ul\">\n\n\n                {{#each hotItmes}}\n                <li class=\"tab-pannel item{{id}}\">\n                    <img src=\"{{pic}}_q90.jpg\">\n                    {{#if link}}\n                        <a href=\"{{link}}\" target=\"_blank\">\n                    {{else}}\n                        <a href=\"//izhongchou.taobao.com/dreamdetail.htm?id={{id}}\" target=\"_blank\" class=\"hot-link\">\n                    {{/if}}\n                        <div class=\"item-title\">{{title}}</div>\n                        <div class=\"des\">{{dec}}</div>\n                        <div class=\"text-per\">达成率</div>\n                        <div class=\"per\"><span class=\"J_per\"></span>%</div>\n                    </a>\n                </li>\n                {{/each}}\n\n            </ul>\n        </div>\n\n    </div>\n</div>"};
});
/**
 * Generated By grunt-kissy-template
 */
KISSY.add('page/tpl/item-tpl',function(){
    return {"html":"\n<li class=\"nav-item{{#if index%4===0}} first {{/if}}\">\n    {{#if link}}\n        <a class=\"link\" href=\"{{link}}\" target=\"_blank\">\n    {{else}}\n        <a class=\"link\" href=\"//izhongchou.taobao.com/dreamdetail.htm?id={{id}}\" target=\"_blank\">\n    {{/if}}\n                        <span class=\"project-area\">\n                            <img data-ks-lazyload=\"{{image}}_300x300.jpg\" alt=\"\" class=\"project-pic\" src=\"//img.alicdn.com/tps/i3/TB1LfUaIXXXXXahXXXXAK_xZVXX-290-190.png\">\n\n                            <b class=\"shadow\"></b>\n                        </span>\n                        <span class=\"project-intro\">{{name}}</span>\n    </a>\n                     <span class=\"tag-con\">\n\n                         {{#if tag}}\n                         {{#each tag}}\n                            <span class=\"tag tag-link\" data-spm-click=\"gostr=/wapsvip;locaid=d{{id}}{{xindex}}\">{{this}}</span>\n                         {{/each}}\n                         {{/if}}\n                        </span>\n\n                        <span class=\"schedule-bar\">\n\n\n                            <i class=\"schedule-current {{#if hasfinish===1}}full{{/if}}\" style=\"width:{{showWidth}}%;\"></i>\n\n\n                        </span>\n\n\n\n                        <span class=\"project-schedule\">\n                            <span class=\"other-info\">\n                                <span class=\"every-info info-deal\">\n                                    <em class=\"info-num\">{{finish_per}}%</em>\n                                    <em class=\"info-name\">达成率</em>\n                                </span>\n                                <span class=\"every-info info-dollar\">\n                                    <em class=\"info-num\">{{curr_money}}</em>\n                                    <em class=\"info-name\">已筹金额</em>\n                                </span>\n                                <span class=\"every-info info-support\">\n                                    <em class=\"info-num\">{{buy_amount}}</em>\n                                    <em class=\"info-name\">支持人数</em>\n                                </span>\n                            </span>\n                        </span>\n\n</li>\n"};
});
/**
 * Generated By grunt-kissy-template
 */
KISSY.add('page/tpl/order-tpl',function(){
    return {"html":"<div class=\"item-detail\">\n    <b class=\"indicate J_WeeklyHot\" style=\"top: 16px;\"></b>\n    {{#each data}}\n        {{#if link}}\n            <a class=\"J_itemDetailBox\" href=\"{{link}}\" target=\"_blank\">\n        {{else}}\n            <a class=\"J_itemDetailBox\" href=\"//izhongchou.taobao.com/dreamdetail.htm?id={{id}}\" target=\"_blank\">\n        {{/if}}\n                    <span class=\"item-detail-box item-detail-box-{{xindex+1}}  {{#if xindex===0}} item-detail-show{{/if}}\">\n                        <span class=\"item-image\">\n                            {{#if xindex===0}}\n                                 <img src=\"{{image}}_430x430.jpg\" alt=\"\">\n\n                            {{else}}\n                                 <img data-ks-lazyload=\"{{image}}_430x430q75.jpg\" alt=\"\" src=\"//img.alicdn.com/tps/i3/TB1LfUaIXXXXXahXXXXAK_xZVXX-290-190.png\">\n\n                            {{/if}}\n\n                        </span>\n                        <span class=\"item-info\">\n                            <span class=\"title\">{{name}}</span>\n                            <span class=\"money-title\">目前累计资金:</span>\n                            <span class=\"current-money\"><span class=\"yen\">¥</span>{{curr_money}}</span>\n                            <span class=\"project-status-detail\">\n                                <span class=\"project-status-bar\">\n                                <span class=\"schedule-bar\">\n                                    <i class=\"schedule-current progress-bar progress-bar-striped active\" style=\"width:{{showWidth}}%;\"></i>\n                                </span>\n                                    <span class=\"percentage\">{{finish_per}}%</span>\n                                </span>\n                                <span class=\"projects-schedule-data\">\n\n                                    <span class=\"support-number\"><b>&#xe622;</b>支持人数:</span><span class=\"data-number\">{{buy_amount}}</span>\n                                    <span class=\"time-left\"><b>&#xe623;</b>剩余时间:</span><span class=\"data-number\">{{remain_day}}天</span>\n                                </span>\n                            </span>\n                            <span class=\"desc\">\n                                {{{project_desc}}}\n                            </span>\n                        </span>\n\n                    </span>\n    </a>\n    {{/each}}\n\n\n</div>\n\n<ul class=\"right-panel\">\n    {{#each data}}\n        <li class=\"J_Top {{#if xindex===0}} current{{/if}}\" >\n            <i>{{xindex+1}}</i>\n            <div class=\"info-con\">\n                <span class=\"project-title\">{{name}}</span>\n                <span class=\"support-num\">{{buy_amount}}人支持&nbsp;&nbsp;达成率{{finish_per}}%</span>\n            </div>\n        </li>\n    {{/each}}\n</ul>"};
});
/**
 * Generated By grunt-kissy-template
 */
KISSY.add('page/tpl/success-tpl',function(){
    return {"html":"\n\n<ul class=\"suc-ul clearfloat J_sucUL\">\n    {{#each items}}\n    <li class=\"item{{id}}\">\n        <span class=\"pic-wrap\">\n            <img class=\"DataLazyload\"  data-ks-lazyload=\"{{img}}\"  alt=\"\" src=\"//img.alicdn.com/tps/i3/TB1LfUaIXXXXXahXXXXAK_xZVXX-290-190.png\">\n        </span>\n        <span class=\"avatar\">\n            <img src=\"{{publisherAvatar}}\" alt=\"\">\n        </span>\n\n        <div class=\"funder-intro\">\n            <div class=\"funder-name\">{{publisherNick}}</div>\n            <div class=\"funder-info\">{{publisherDesc}}</div>\n        </div>\n\n        <div class=\"money-raise\"><span class=\"text\">获得筹款</span><span class=\"colon\">:</span><em class=\"number J_money\"></em><i class=\"yen\">元</i> </div>\n        <div class=\"support-number\"><span class=\"text\">支持人数</span><span class=\"colon\">:</span><em class=\"number J_support\"></em><i class=\"yen\">人</i></div>\n\n        <div class=\"desc-content\">{{desc}}</div>\n        {{#if link}}\n            <a class=\"link\" href=\"{{link}}\" target=\"_blank\">\n        {{else}}\n            <a class=\"link\" href=\"//izhongchou.taobao.com/dreamdetail.htm?id={{id}}\" target=\"_blank\">\n        {{/if}}\n            查看项目\n        </a>\n    </li>\n\n{{/each}}\n\n</ul>"};
});
/**
 * Generated By grunt-kissy-template
 */
KISSY.add('page/tpl/nav-tpl',function(){
    return {"html":"\n{{#each navs}}\n<div class=\"nav-block loading {{#if navs.length-1=== xindex}}last{{/if}} {{#if xindex === 0}}first{{/if}}\" id=\"J_nav{{navId}}_{{xindex}}\">\n    <div class=\"floor-info\">\n        <a href=\"//hi.taobao.com/market/hi/list.php#type={{navId}}\" target=\"_blank\">\n            <span class=\"num\">{{xindex+1}}F</span>\n            <span class=\"name\">{{nav}}</span>\n            <span class=\"icon\">&#xe629;</span>\n        </a>\n        <span class=\"line\"></span>\n    </div>\n\n    <ul class=\"nav-list clearfloat\">\n\n        <li class=\"nav-item  first nav-tag\">\n\n           <img class=\"main-img\" src=\"{{bg}}_q90.jpg\">\n\n\n            <a class=\"first-link J_detailLink\" href=\"\" target=\"_blank\" style=\"color: {{color}}\">\n                <div class=\"item-info\">\n                    <div class=\"name\">{{firstItem}}</div>\n\n                        <div class=\"money\">已筹金额&nbsp;<i class=\"yen\">¥</i><span class=\"J_money\"></span></div>\n                        <span class=\"item-link\" href=\"\" target=\"_blank\" style=\"color: {{color}}\">\n                            <span class=\"text\">查看项目</span>\n                            <span class=\"icon\">&#xe603;</span>\n                        </span>\n                </div>\n            </a>\n\n        </li>\n\n\n    </ul>\n</div>\n{{/each}}"};
});
KISSY.add('page/init', function(S, UA, Node, IO, Event, Xtpl, Slide, FirstTpl, PreTpl, HotTpl, ItemTpl, OrderTpl, SucTpl, NavTpl, DataLazyload) {
  var $ = S.all;
  var isDaily = location.host.indexOf('daily') >= 0;

  var time = Date.parse(new Date());
  var MINTime = Date.parse(new Date('2015/12/01 00:00'));
  var MAXTime = Date.parse(new Date('2015/12/13 00:00'));
  var is1212 = (time > MINTime && time < MAXTime);
  var isCDN = ($('#J_cache')[0].value === '1');

  function Home() {
    var self = this;
    self.init();
  }

  Home.prototype = {
    init: function() {
      this.globalData = {};
      is1212 && $('.s-focus').addClass('atmosphere');

      this.slideBar();
      this.firstScroll();
      this.preScroll();
      this.hotScroll();
      this.tagEvent();

      this.lazyLoad(this.loadModule);

      //this.orderEvent();
      //this.newScroll();
      new DataLazyload($(document));



    },

    slideBar: function() {
      var navTop = $('.s-nav').offset().top;
      var navBlock = $('.nav-block');
      var navNum = navBlock.length;
      var sideLi = $('#J_barUL').all('li');
      var sideNav = {
        top: navTop - 200,
        speed: 0.3,
        navobj: $(".ss_nav"),
        gotopbtn: $("#J_goTop")

      };
      sideNav.gotop = function() {
        this.gotopbtn.on("click", function() {
          $(window).animate({"scrollTop": 0}, .5);
        });
      };
      sideNav.init = function() {
        var self = this;
        $(window).on("scroll", function() {
          var sctop = $(window).scrollTop();
          if (sctop >= self.top) {
            self.navobj.show(self.speed);
          }
          else {
            self.navobj.hide(self.speed);
          }
          for (var i = 0; i < navNum; i++) {
            var item = navBlock[i];
            var nextItem;
            if (i < navNum - 1) {
              nextItem = navBlock[i + 1];
            } else {
              nextItem = $('.s-order');
            }
            var $item = $(item);
            var itemTop = $item.offset().top;
            var nextTop = $(nextItem).offset().top;
            sideLi.removeClass('on');
            if (sctop >= itemTop - 450 && sctop < nextTop - 250) {
              $(sideLi[i]).addClass('on');
              break;
            }
          }
        });
        self.gotop();
      };
      sideNav.init();
    },

    firstScroll: function() {

      //焦点图轮播
      var bg = $('#J_scroll').one('.tab-pannel').attr('data-color');
      !is1212 && $('#J_focus').css('backgroundColor', bg);
      var focuScroll = new Slide('#J_scroll', {
        autoSlide: true,
        effect: 'hSlide',
        timeout: 3000,
        speed: 700,
        eventType: 'mouseover',
        selectedClass: 'current',
        carousel: true
      });
      focuScroll.play();
      focuScroll.on("switch", function(e) {
        var $pannelnode = $(e.pannelnode);
        bg = S.trim($pannelnode.attr('data-color'));
        var defaultColor = '#ededed';
        bg = bg == '' ? defaultColor : bg;
        !is1212 && $('#J_focus').css('backgroundColor', bg);
      });

      $(document).delegate('click', '.J_SlidePrev', function(e) {
        e.stopPropagation();
        focuScroll.previous();
      }).delegate('click', '.J_SlideNext', function(e) {
        e.stopPropagation();
        focuScroll.next();
      });


    },
    preScroll: function() {
      var config = {
        autoSlide: false,
        effect: 'hSlide',
        timeout: 3000,
        speed: 800,
        eventType: 'mouseover',
        selectedClass: 'current',
        carousel: true
      };

      var scrollLen1 = $('#tab-content0').all('.tab-pannel').length;
      var scrollLen2 = $('#tab-content2').all('.tab-pannel').length;
      var scrollLen3 = $('#tab-content4').all('.tab-pannel').length;

      if (scrollLen1) {
        var preScroll1 = new Slide('#tab-content0', config);
      }
      if (scrollLen2) {
        var preScroll2 = new Slide('#tab-content2', config);
      }
      if (scrollLen3) {
        var preScroll3 = new Slide('#tab-content4', config);
      }

      $(document).delegate('click', '.J_preSL', function(e) {
        e.stopPropagation();
        preScroll1 && preScroll1.previous();
        setTimeout(function() {
          preScroll2 && preScroll2.previous();
        }, 600);
        setTimeout(function() {
          preScroll3 && preScroll3.previous();
        }, 1200);
      }).delegate('click', '.J_preSR', function(e) {
        e.stopPropagation();
        preScroll1 && preScroll1.next();
        setTimeout(function() {
          preScroll2 && preScroll2.next();
        }, 600);
        setTimeout(function() {
          preScroll3 && preScroll3.next();
        }, 1200);
      }).delegate('click', '.new-change', function(e) {
        var $target = $(e.currentTarget);
        $('.new-change').removeClass('on');
        $target.addClass('on');
      });
    },

    tagEvent: function() {


      Event.delegate(document, 'click', '.tag-link', function(e) {
        e.preventDefault();
        var target = $(e.currentTarget);
        var value = S.trim(target.html());
        var searchUrl = '//hi.taobao.com/market/hi/list.php' + '?query=' + encodeURI(value) + '#sort=1';
        window.open(searchUrl);
      });
    },

    orderEvent: function() {
      $(document).delegate('mouseenter', '.J_Top', function(e) {
        var target = $(e.currentTarget);
        var index = target.index();
        $('.current').removeClass('current');
        target.addClass('current');
        $('.item-detail-show').removeClass('item-detail-show');
        $('.item-detail-box-' + (index + 1)).addClass('item-detail-show');
        $('.J_WeeklyHot').css('top', 16 + 62 * index);
        new DataLazyload($('#J_orderSection'));

      });
    },
    hotScroll: function() {
      //热门推荐轮播
      var hotConNode = $('#J_hotScroll');
      var itemLen = hotConNode.all('.tab-pannel').length;
      var changeR = $('.J_hotSR');
      var changeL = $('.J_hotSL');
      var NUM = 5;

      if (itemLen > 5) {
        changeR.removeClass('hidden');
      }

      if (!itemLen) {
        return;
      }

      var hotScroll = new Slide('#J_hotScroll', {
        autoSlide: false,
        effect: 'hSlide',
        timeout: 3000,
        speed: 1100,
        eventType: 'mouseover',
        selectedClass: 'current',
        carousel: false
      });
      hotScroll.on("switch", function(e) {
        if (e.index == 0) {
          changeL.addClass('hidden');
        }
        if (e.index > 0) {
          changeL.removeClass('hidden');
        }
        if (e.index == itemLen - NUM) {
          changeR.addClass('hidden');
        }
        if (e.index < itemLen - NUM) {
          changeR.removeClass('hidden');
        }
      });

      $(document).delegate('click', '.J_hotSL', function(e) {
        e.stopPropagation();
        hotScroll.previous();
      }).delegate('click', '.J_hotSR', function(e) {
        e.stopPropagation();
        hotScroll.next();
      });

    },
    newScroll: function() {

      //最新上线轮播
      var newScroll = new Slide('#J_newScroll', {
        autoSlide: false,
        effect: 'hSlide',
        timeout: 3000,
        speed: 1100,
        eventType: 'mouseover',
        selectedClass: 'current',
        carousel: true
      });
      $(document).delegate('click', '.J_newSL', function(e) {
        e.stopPropagation();
        newScroll.previous();
        new DataLazyload($('#J_newSection'));
      }).delegate('click', '.J_newSR', function(e) {
        e.stopPropagation();
        newScroll.next();
        new DataLazyload($('#J_newSection'));
      })

    },


    getProject: function(param, callback, jsonpCallback) {
      var url = isDaily ? "//izhongchou.daily.taobao.net/dream/ajax/getProjectList.htm" : "//izhongchou.taobao.com/dream/ajax/getProjectList.htm";
      url = isCDN ? "//hstar-hi.alicdn.com/dream/ajax/getProjectList.htm" : url;
      var config = {
        dataType: 'jsonp',
        url: url,
        data: param,
        jsonp: "callback",
        success: function(d) {
          if (d.status == '1') {
            callback(d);
          } else {
            console && console.log("接口返回失败");
          }
        },
        error: function() {
          console && console.log("服务器请求失败，请稍后重试");
        }
      };
      if (isCDN) {
        config.cache = true;
        config.jsonpCallback = 'jsonp'+jsonpCallback;
      }

      new IO(config);
    },


    lazyLoad: function(callback) {
      var self = this;
      var lazyNode = $('.J_lazyload');
      var ahead = 150;
      var wHeight = $(window).height();

      checkLoad();

      $(window).on('scroll', function() {
        timer && clearTimeout(timer);
        var timer = setTimeout(function() {
          checkLoad();
        }, 50);

      });



      function checkLoad() {

        for (var i = 0; i < lazyNode.length; i++) {
          if (lazyNode[i].init !== true) {
            var node = $(lazyNode[i]);
            var scrollTop = $(window).scrollTop();
            var nodeTop = node.offset().top;
            if (wHeight + scrollTop >= nodeTop - ahead) {
              lazyNode[i].init = true;
              callback(node, self);

            }
          }
        }
      }
    },
    loadModule: function(node, obj) {
      var self = obj;
      var param;
      //精彩类目模块
      if (node.hasClass('nav-block')) {
        var ids = node.attr('data-id');
        var nodeId = node.attr('id');
        param = {
          "page": 1,
          "type": 4,
          ids: ids
        };
        self.getProject(param, function(d) {

          var navResult = d.data;
          if (!navResult.length) return;
          var firstData = navResult[0];
          var _html = '';
          node.one('.J_money').html(firstData.curr_money);
          S.each(navResult, function(item, index) {
            if (!index) return;
            item.index = index;
            item = self.handleItems(item);
            _html += new Xtpl(ItemTpl.html).render(item);
          });
          node.one('.nav-list').append(_html);
          node.removeClass('loading');
          new DataLazyload($('#J_navSection'));
        }, nodeId);

        //排行榜模块
      } else if (node.hasClass('s-order')) {
        param = {
          "type": 1,
          "page": 1,
          "pageSize": 5
        };
        self.getProject(param, function(d) {
          var orderData = d.data;
          S.each(orderData, function(item, index) {
            item = self.handleItems(item);
            orderData[index] = item;
          });
          $('.J_WeeklyContent').html(new Xtpl(OrderTpl.html).render({data: orderData}));
          $('#J_orderSection').removeClass('loading');
          self.orderEvent();
        }, 'jsonpOrder');

        //最新上线模块
      } else if (node.hasClass('s-new')) {
        param = {
          page: 1,
          pageSize: 12,
          type: 2
        };
        self.getProject(param, function(d) {
          var itemData = d.data,
            _html = '';
          S.each(itemData, function(item, index) {

            if (index < 12) {

              item.index = index;
              itemData[index] = self.handleItems(item);
              if (index % 4 == 0) {
                _html += ' <ul class="tab-pannel nav-list  clearfloat">';
              }
              _html += new Xtpl(ItemTpl.html).render(itemData[index]);
              if (index % 4 == 3) {
                _html += '</ul>';
              }
            }
          });
          $('#J_newScroll').one('.tab-content').html(_html);
          $('#J_newSection').removeClass('loading');

          self.newScroll();
          new DataLazyload($('#J_newSection'));

        }, 'jsonpNew');
      } else if (node.hasClass('s-success')) {
        var sucIds = node.attr('data-id');
        self.getProject({
          "page": 1,
          "type": 4,
          ids: sucIds
        }, function(d) {
          var sucCon = $('.J_sucUL');
          var sucResult = d.data;
          var temp, tempLi;
          for (var j = 0; j < sucResult.length; j++) {
            temp = sucResult[j];
            tempLi = sucCon.one('.item' + temp.id);
            tempLi.one('.J_money').html(self.handleMoney(temp.curr_money));
            tempLi.one('.J_support').html(temp.buy_amount);
          }
        }, 'jsonpSuc');
      } else if (node.hasClass('s-hot')) {
        var hotIds = node.attr('data-id');
        self.getProject({
          "page": 1,
          "type": 4,
          ids: hotIds
        }, function(d) {
          var hotCon = $('#J_hotScroll');
          var hotResult = d.data;
          var temp, tempLi;
          for (var j = 0; j < hotResult.length; j++) {
            temp = hotResult[j];
            tempLi = hotCon.one('.item' + temp.id);
            tempLi.one('.J_per').html(temp.finish_per);
          }
        }, 'jsonpHot');
      }
    },
    handleItems: function(item) {
      var dateArr = item.plan_end_date.split('/');
      item.finish_per = +item.finish_per || 0;
      item.plan_end_date = dateArr[1] + '/' + dateArr[2];
      if (item.finish_per >= 100) {
        item.hasfinish = 1;
        item.showWidth = 100;
      } else {
        item.hasfinish = 0;
        item.showWidth = item.finish_per;
      }
      return item;
    },

    handleMoney: function(s, n) {
      n = n > 0 && n <= 20 ? n : 2;
      s = parseFloat((s + "").replace(/[^\d\.-]/g, "")).toFixed(n) + "";
      var l = s.split(".")[0].split("").reverse(),
        r = s.split(".")[1],
        t = "";
      for (i = 0; i < l.length; i++) {
        t += l[i] + ((i + 1) % 3 == 0 && (i + 1) != l.length ? "," : "");
      }
      return t.split("").reverse().join("") + "." + r;
    }

  };

  new Home();

}, {
  requires: [
    "ua",
    "node",
    "io",
    "event",
    "xtemplate",
    'kg/slide/2.0.2/',
    './tpl/first-tpl',
    './tpl/pre-tpl',
    './tpl/hot-tpl',
    './tpl/item-tpl',
    './tpl/order-tpl',
    './tpl/success-tpl',
    './tpl/nav-tpl',
    'kg/datalazyload/2.0.2/index'
//    ,
//    'utils/common/gotop'
  ]
});
KISSY.use('page/init');
