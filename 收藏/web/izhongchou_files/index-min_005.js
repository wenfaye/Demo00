/*! mini-login 2013-06-17 */
KISSY.add("tbc/mini-login/1.0.0/index",function(a,b,c,d,e){function f(){var a='<div id="J_LoginContainer" class="login-container" style="display:none" style="width:'+(u.width+2)+"px;height:"+(u.height+30)+'px">'+'<div class="login-wrapper">'+'<div class="login-hd">\u6dd8\u5b9d\u4f1a\u5458</div>'+'<div class="login-bd">'+'<iframe data-status="0" frameborder="0" width="'+u.width+'" height="'+u.height+'" scrolling="no" id="J_LoginFrame" name="LoginFrame" src="about:blank" onload="_TBC_MiniLogin_Check(this.id, this.name)"></iframe>'+"</div>"+'<div class="login-ft">'+'<a class="login-close J_LoginClose" title="\u5173\u95ed\u6b64\u7a97\u53e3" href="javascript:void(0)">\xd7</a>'+"</div>"+"</div>"+"</div>",c=b.create(a);return b.addStyleSheet(w),b.append(c,document.body),g(c),c}function g(a){c.on(a,"click",function(a){var c=a.target;b.hasClass(c,"J_LoginClose")&&m()})}function h(){var b,c=e.get("uc1"),d=e.get("_nk_"),f=e.get("ck1");return c&&(b=a.unparam(c).cookie15),(b||e.get("_l_g_"))&&(d||f)}function i(a){return q&&!h()?(a&&j(),!1):(d.getScript(s,function(){"undefined"!=typeof loginIndicator&&(loginIndicator.hasLoggedIn?n():a&&j())}),void 0)}function j(){var a,c,d=b.get("#J_LoginContainer");d||(d=f()),a=b.get("#J_LoginFrame"),c=p.build(r,{redirect_url:u.redirect_url,from:u.from}),b.css(d,"display","block"),k(),b.attr(a,"data-status","0"),a.src=v}function k(){l(),c.on(window,y,l)}function l(){var a=b.get("#J_LoginContainer"),c=parseInt(b.viewportWidth()/2)-parseInt(a.offsetWidth/2)+"px",d=(x?b.scrollTop():0)+parseInt(b.viewportHeight()/2)-parseInt(a.offsetHeight/2)+"px";b.css(a,{top:d,left:c})}function m(){var a=b.get("#J_LoginContainer");if(!a)return!1;b.css(a,"display","none"),c.remove(window,y,l);var d=o.hide;d&&d()}function n(){m();var a=o.success;a&&a()}var o,p={getServer:function(a){var b,c,d=-1!==location.host.indexOf("daily"),e=/\{(.+?)Server\}/i,f=e.exec(a);return f&&f[1]?(b=f[1],c=d?a.replace(e,"daily."+b+".net"):a.replace(e,b+".com")):c=a,c},build:function(b,c){var d=-1!==b.indexOf("?"),e=d?"&":"?";return a.isObject(c)?b+e+a.param(c):b+e+c}},q=/taobao|tmall/.test(location.host),r=p.getServer("https://login.{taobaoServer}/member/login.jhtml?style=mini&is_ignore=false"),s=p.getServer("http://buy.{taobaoServer}/auction/buy.htm?from=itemDetail"),t=window.g_config?g_config.loginCfg:{},u=a.merge({width:328,height:285,redirect_url:"http://www.taobao.com/go/act/loginsuccess/taobao.php"},t||{}),v=p.build(r,{redirect_url:u.redirect_url,from:u.from}),w=".login-container{opacity:1;position:fixed;_position:absolute;z-index:5000;background-color:#fafafa;padding:0;overflow:hidden;-moz-border-radius:3px;-webkit-border-radius:3px;border-radius:3px;border:3px solid #D5D5D5;}.login-container .login-wrapper{border:1px solid #aaa}.login-container .login-hd{height:35px;line-height:35px;padding-left:14px;font-weight:700;font-size:14px;margin-bottom:25px;background-color:#f2f2f2;}.login-container .login-ft{background-color:#F5F5F5;}.login-container .login-close{color:#9c9c97;font-family:Tahoma,sans;font-size:22px;position:absolute;right:8px;text-decoration:none;top:-2px;}",x=6===a.UA.ie,y=x?"scroll resize":"resize";return window._TBC_MiniLogin_Check=function(a,c){var d=b.get("#"+a),e=!1,f=o.success,g=o.failure;if("0"===b.attr(d,"data-status"))b.attr(d,"data-status","1");else{try{href=win.frames[c].location.host,href?-1===href.indexOf("login")&&(m(),f&&f()):e=!0}catch(h){e=!0}e?i():g&&g()}},{check:h,show:function(b){o=a.isFunction(b)?{success:b}:b||{},i(!0)},hide:function(){m()},ajax:function(a,b){var c=this,e=a.success;return e?(a.success=function(d){b(d)?e(d):c.show(a.success)},q&&!h()?c.show(a.success):(d(a),void 0)):!1}}},{requires:["dom","event","ajax","cookie"]});