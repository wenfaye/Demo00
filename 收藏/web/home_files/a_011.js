KISSY.add("jbc/jufav/1.0.32/index",function(t,a){function e(){t.ready(function(){var e=t.all("#J_HasJufav").val();"false"!=e&&a.init()})}function n(){a.addData.apply(null,arguments)}return{init:e,addData:n}},{requires:["./mods/jutools","./jufav.css","core"]}),KISSY.add("jbc/jufav/1.0.32/mods/favbox",function(t,a,e,n,i){var o=t.all,s=t.DOM,l=(t.Node,t.Event,t.Anim),c=t.IO,r="#J_favNumDom",d="#J_surNumDom",u="#J_favItemlistwrap",f="#J_surItemlistwrap",p="#J_favItemList",g="#J_surItemList",v="#J_favTagCon",m="#J_surTagCon",h="#J_favSubNav li",b="#J_surSubNav li",_=".J_icondel",j=".J_item",w="#J_justar em",k="#J_favboxparent",y="#J_justar",J="#J_justar i",x="#J_surmsg";if(-1!==window._ju_config.domain.indexOf("daily"))var C="//detail.ju.daily.taobao.net/",S="//dskip.ju.daily.taobao.net/",D="//img02.taobaocdn.net/bao/uploaded/",T="//dskip.ju.daily.taobao.net/json/collect_mark.htm";else var C="//detail.ju.taobao.com/",S="//dskip.ju.taobao.com/",D="//gju1.alicdn.com/bao/uploaded/",T="//dskip.ju.taobao.com/json/collect_mark.htm";var I={config:{getData:{url:S+"json/collect_list.htm",param:[{name:"listType",enumval:["collect","favorite"]},{name:"queryType",enumval:[1,2,3]}]},addData:{url:S+"json/add_collect.htm",param:[{name:"id"}]},delData:{url:S+"json/delete_collect.htm",param:[{name:"id"}],delStatus:!0},html_temp:"<div class='favboxwrap' id='J_favbox'><div class='favboxframe'><div class='tagtit J_tagtit'><ul><li id='J_favNumDom' class='active'>我的聚收藏（<span>0</span>）</li><li id='J_surNumDom'>聚有惊喜（<span>0</span>）</li></ul></div><div class='tagcon'><div class='tagconwrap myjufav' id='J_favTagCon' data-spm='dp0'><div class='subnav' id='J_favSubNav'><ul><li class='active'>全部</li><li>开团中</li><li>即将开团</li></ul></div><div class='itemlistwrap' id='J_favItemlistwrap'></div></div><div class='tagconwrap jusurprise' id='J_surTagCon' data-spm='dp1'><div class='subnav' id='J_surSubNav'><ul><li class='active'>全部</li><li>开团中</li><li>即将开团</li></ul></div><div class='surmsg' id='J_surmsg'>亲，您淘宝收藏夹里的宝贝上聚划算啦！</div><div class='itemlistwrap' id='J_surItemlistwrap'></div></div></div></div></div>"},init:function(a,e,i){t.use("jbc/julog",function(t,e){e.track("jufav",20,"favbox.init.click","[v"+a+"]")}),I.getData(0,0,function(l){if(!l||"SUCCESS"!==l.type)return"click"!=i||n.isLogin()?(s.removeClass(y,"justara_on"),s.removeClass(J,"loginin")):(t.use("jbc/julog",function(t,e){e.track("jufav",16,"favbox.init.login","[v"+a+"]")}),n.login(function(){I.getCollectMark(),t.use("jbc/julog",function(t,e){e.track("jufav",16,"favbox.init.loginsuccess","[v"+a+"]")}),s.addClass(J,"loginin"),o(y).fire("click")})),void(e&&e(!1));if(t.use("jbc/julog",function(t,e){e.track("jufav",20,"favbox.init.datasuccess","[v"+a+"]")}),s.html(k,I.config.html_temp),o(r).one("span").text(l.collectcount),l.collectcount&&t.use("jbc/julog",function(t,e){e.track("jufav",20,"favbox.init.havcollect","[v"+a+"]")}),l.favoritecount){t.use("jbc/julog",function(t,e){e.track("jufav",18,"favbox.init.havfavorite","[v"+a+"]")}),o(d).one("span").text(l.favoritecount),o(b).on("click",function(){if(!s.hasClass(this,"active")){var t=o(b).index(this);o(b).removeClass("active"),o(this).addClass("active"),I.getData(1,t,function(t){t&&"SUCCESS"===t.type&&I.showData(t.result,1)}),window.goldlog&&window.goldlog.send("//gm.mmstat.com/jhs.4.3.8?name=tab&type=1&subtype="+t+"&page="+a)}}),o(r).on("click",function(){o(r).hasClass("active")||(o(r).addClass("active"),o(d).removeClass("active"),o(v).fadeIn(.3),o(m).fadeOut(.3),window.goldlog&&window.goldlog.send("//gm.mmstat.com/jhs.4.3.8?name=tab&type=0&page="+a))});var c=!1;o(d).on("click",function(){o(d).hasClass("active")||(o(r).removeClass("active"),o(d).addClass("active"),c||(c=!0,I.getData(1,0,function(t){t&&"SUCCESS"===t.type&&I.showData(t.result,1)})),o(v).fadeOut(.3),o(m).fadeIn(.3),window.goldlog&&window.goldlog.send("//gm.mmstat.com/jhs.4.3.8?name=tab&type=1&page="+a))})}else o(d).hide(),o(r).css("width","100%");I.showData(l.result,0),o(h).on("click",function(){if(!s.hasClass(this,"active")){var t=o(h).index(this);o(h).removeClass("active"),o(this).addClass("active"),I.getData(0,t,function(t){t&&"SUCCESS"===t.type&&I.showData(t.result,0)}),window.goldlog&&window.goldlog.send("//gm.mmstat.com/jhs.4.3.8?name=tab&type=0&subtype="+t+"&page="+a)}}),o(u).delegate("click",_,function(t){if(I.config.delData.delStatus){I.config.delData.delStatus=!1;var a=t.currentTarget,e=o(s.parent(a,j)).attr("data-id");I.delData(e)}}),I.getCollectMark(),e&&e(!0)})},reset:function(){s.empty(k)},showData:function(t,e){t=t||[];var n=I.parseData(t,e);0==e?(o(u).html(n),I.favKscroll=new a(o(p),{prefix:"clear-",hotkey:!0,bodydrag:!1,allowArrow:!0})):(o(f).html(n),I.surKscroll=new a(o(g),{prefix:"clear-",hotkey:!0,bodydrag:!1,allowArrow:!0}))},getData:function(t,a,e){for(var n=arguments,i=I.config.getData.url,o={_input_charset:"utf-8"},s=I.config.getData.param,l=0;l<s.length;l++)o[s[l].name]=s[l].enumval[n[l]];c.jsonp(i,o,function(t){e&&e(t)})},addData:function(a,e,d,f,g,v){function m(){KISSY.juReady(function(t){for(var a=I.config.addData.url,e={_tb_token_:t.tbToken},n=I.config.addData.param,i=0;i<n.length;i++)e[n[i].name]=y[i];c.jsonp(a,e,function(t){"BUSY"==t.type||"ERROR"==t.type?b(t.message):(_(),h()),window.addToCollectionStatus=!0})})}function h(a){if(e&&t.one(e)&&NaN!==parseInt(t.one(e).text())){var n=parseInt(t.one(e).text())+1;t.one(e).text(n)}}function b(t){o(".J_Add_jufav").html(t||"对不起，加入聚收藏失败！"),x.show()}function _(){var a=t.one("#J_justar"),e=t.one(f);if(a&&e){var n=a.offset(),i=e.offset();n.left+=10,n.top+=10,i.left+=g||0,i.top+=v||0;var o=t.one('<i style="background: url(//gtms01.alicdn.com/tps/i1/T1QyRoFsXbXXbv3u_a-21-20.png) no-repeat 0 0;width: 21px;height: 20px;display: inline-block;position: absolute;left: 0;top: 0;z-index:11000"></i>');o.css("left",i.left+"px"),o.css("top",i.top+"px"),o.appendTo("body"),t.Anim(o[0],{top:n.top+"px",opacity:.3},{queue:!1,duration:.6,easing:"backIn"}).run(),t.Anim(o[0],{left:n.left+"px"},{queue:!1,duration:.6,easing:"easeNone",complete:function(){o.remove(),I.heartFlash(),d&&k()}}).run()}}function k(){if(o(w).length&&o(w).one("b")){var t=parseInt(o(w).one("b").text())+1;o(w).one("b").text(t)}o(r).length&&I.getData(0,0,function(t){if(t&&"SUCCESS"===t.type)for(var e=0;e<t.result.length;e++)if(t.result[e].id==a){var n=parseInt(o(r).one("span").text())+1;o(r).one("span").text(n);var i=I.parseData([t.result[e]],2),c=s.create(i,{height:0,opacity:0},document);o(u).all(j).length||s.empty(p),s.prepend(c,p);var d=new l(c,{height:84,opacity:1},.3,"easeNone",function(){I.favKscroll.resize()});d.run()}})}if(a){var y=arguments,J=!0;n.login(function(){J&&(J=!1,I.getCollectMark(),m())})}else _(),h(),window.addToCollectionStatus=!0;var x=new i({title:"<em>提示</em>",content:'<div class="J_Add_jufav"></div>',autoShow:!1,wrapId:"J_coupons_popup_wrap",buttons:[{style:"buttonClass",text:"关闭",func:function(){this.hide()}}]})},delData:function(t){var a=arguments;KISSY.juReady(function(e){for(var n=I.config.delData.url,i={_tb_token_:e.tbToken},d=I.config.delData.param,f=0;f<d.length;f++)i[d[f].name]=a[f];c.jsonp(n,i,function(a){if("SUCCESS"==a.type){var e=o(r).one("span").text();if(o(r).one("span").text(parseInt(e)-1),o(w).length&&o(w).one("b")){var n=parseInt(o(w).one("b").text())-1;o(w).one("b").text(n)}o(u).all(j).each(function(a,e){if(a.attr("data-id")==t){var n=new l(a,{height:0,opacity:0},.3,"easeNone",function(){s.remove(a),I.favKscroll.resize(),o(u).all(j).length||o(u).html("<div class='itemlist' id='J_favItemList'><div class='nodata'>亲，你是啥都看不上呢还是啥也没看？里面好空哦...</div></div>")});n.run(),setTimeout(function(){I.config.delData.delStatus=!0},300)}})}else I.config.delData.delStatus=!0})})},parseData:function(a,e){var n="";if(0==e&&(n="<div class='itemlist' id='J_favItemList'>"),1==e&&(n="<div class='itemlist' id='J_surItemList'>"),t.unique(a),a&&a.length)for(var i=0;i<a.length;i++)a[i].id||(a.splice(i,1),i--);if(a&&a.length){for(var i=0;i<a.length;i++){var s=parseInt(a[i].onlineStartTime)>(new Date).getTime()?!0:!1,l=a[i].id,c=C+"home.htm?id="+l,r=D+a[i].picUrl+"_100x100.jpg",d=a[i].shortName,u=I.addtitdot(t.trim(d)),f=s?"green":"red",p=a[i].isTmallPointExchange,g=p&&parseInt(a[i].tmallPoint),v=parseInt(a[i].activityPrice)/100,m=parseInt(a[i].originalPrice)/100,h=a[i].soldCount?a[i].soldCount+"件已售":"团购进行中",b=a[i].isLock;0!=b||s||(f="gray",h="卖光了");var _=new Date(parseInt(a[i].onlineStartTime)).formatAs("MM月DD日 hh:mm开团",!0);n+="<div class='item J_item' data-id='"+l+"'>",n+="<div class='itemframe'>",n+="<div class='pic'>",n+="<a target='_blank' href='"+c+"' title='"+d+"'><img src='"+r+"' width='100' height='66'></a>",n+="</div>",n+="<div class='title'><a target='_blank' href='"+c+"' title='"+d+"'>"+u+"</a></div>",n+="<div class='price'>",n+=p?"<span class='"+f+" point'> <strong>"+g+"</strong><em> 天猫积分</em></span>":"<span class='"+f+"'>&yen;<strong>"+v+"</strong></span>",n+=" &yen;<span class='del'>"+m+"</span>",n+="</div>",n+=s?"<div>"+_+"</div>":0==b?"<div class='saleinfo'>"+h+"</div>":"<div class='saleinfo'><span>"+h+"</span><a target='_blank' href='"+c+"' class='btn-msq'>马上抢</a></div>",n+="</div>",(0==e||2==e)&&(n+="<i class='icon-del J_icondel'></i>"),n+="</div>"}1==e&&o(x).show()}else 0==e&&(n+="<div class='nodata'>亲，你是啥都看不上呢还是啥也没看？里面好空哦...</div>"),1==e&&o(x).hide();return 2!==e&&(n+="</div>"),n},addtitdot:function(t){for(var a=0,e=0;e<t.length;e++){a+=t.charCodeAt(e)<=128?.5:1;{if(!(Math.round(a)<=10))return t.substr(0,e)+"...";if(e==t.length-1)return t}}},heartFlash:function(){var t=KISSY.all("#heart");t.show();var a=t.width(),e=t.height(),n=t.css("top"),i=t.css("left"),o=new l("#heart",{height:2*e,width:2*a,top:parseInt(n)-.5*e,left:parseInt(i)-.5*a,opacity:0},.3,"easeOut",function(){t.hide(),t.css({width:a,height:e,top:n,left:i,opacity:1})});o.run()},getCollectMark:function(t){c.jsonp(T,{},function(a,e){"success"==e&&a&&o(w).length&&(a.totalCount||0==a.totalCount)&&o(w).html("<b>"+a.totalCount+"</b> 件"),t&&t()})}};return I},{requires:["gallery/kscroll/1.2/index","gallery/RichDate/1.0/index","jbc/julogin","jbc/jupopup","core"]}),KISSY.add("jbc/jufav/1.0.32/mods/jutools",function(t,a,e){var n=function(){var n=t.DOM,i=t.Event,o=t.Anim,s=null!=navigator.userAgent.match(/iPad/i);this.init=function(){function a(t){var a='<div class="ju-rbar">';return a+='<ul class="ju-groupbar" data-spm="800700">',a+='<li class="backtop J_BackToTop"><a>&#xe61d;</a></li>',t&&(a+='<li class="feedback"><a class="J_feedback" href="'+t+'" title="给聚划算提意见" target="_blank"><span>&#xe606;</span>反馈</a></li>'),a+="</ul>",a+='<div class="jufav" id="J_jufav"><a class="ju-rbara" id="J_justar" href="#"><span class="cnt" id="J_jufavcnt"><span>我的聚收藏 <em></em></span><sub></sub><sup></sup></span><i class="tip-ur"></i></a><div class="favboxparent" id="J_favboxparent"></div><img class="heart" id="heart" src="//gtms01.alicdn.com/tps/i1/T1A30CFvXbXXbhgrfd-29-26.png"></div>',a+="</div>"}var e=this;e.config={interval:200,threshold:500};var n=t.all('[name="spm-id"]').attr("content"),i="https://feedback.taobao.com/pc/feedbacks?productId=155&source=pc-satisfaction";/^http(s)?:.*$/.test(t.all("#J_Feedback").val())?(i=t.all("#J_Feedback").val(),e.temp_trig=a(i)):"608.7065813"==n?(i="https://feedback.taobao.com/pc/feedbacks?productId=155&source=pc-detail",e.temp_trig=a(i)):"608.5847453"==n||"608.5847457"==n?(i="https://feedback.taobao.com/pc/feedbacks?productId=155&source=pc-pinpaituan",e.temp_trig=a(i)):"608.7763366"==n?(i="https://feedback.taobao.com/pc/feedbacks?productId=155&source=pc-jumingpin",e.temp_trig=a(i)):s?e.temp_trig='<a class="pad-backtotop J_BackToTop"></a>':e.temp_trig=a(i),e.trigger=null,e.timer=null,e._render()},this._checkToShow=function(){var a=n.scrollTop(document),e=t.one(".J_BackToTop");a<this.config.threshold?e&&e.animate({opacity:0},.2):e&&e.animate({opacity:1},.2)},this._rendTrigger=function(){var a=this;this.trigger=n.create(this.temp_trig),n.append(this.trigger,document.body),e.getCollectMark(),t.one(a.trigger).fadeIn(.8)},this._getRightDis=function(){var t=n.width(document.body);return t>=1100?parseInt((t-990)/2-66,10):0},this._bindEvent=function(){function s(t,a){v||(v=!0,n.addClass(p,"loginin"),n.addClass(u,"justara_on"),e&&e.init(c.page,function(t){if(t){var e=new o("#J_jufavcnt",{width:187},.15,"easeNone",function(){var t=new o("#J_favboxparent",{height:555,opacity:1},.3,"easeNone",function(){g=!0,v=!1});t.run(),a&&a()});e.run()}else v=!1},t.type))}function l(){if(g){var t=new o("#J_favboxparent",{height:0,opacity:0},.3,"easeNone",function(){g=!1;var t=new o("#J_jufavcnt",{width:117},.15,"easeNone",function(){});t.run(),e.reset(),n.removeClass(u,"justara_on")});t.run()}}var c=this,r=n.get(".J_BackToTop"),d=t.UA.webkit?document.body:document.documentElement;i.on(r,"click",function(a){a.halt();var e=t.UA.ie;e?window.scrollTo(0,0):t.all(window).animate({scrollTop:0},.2,"easeOut",function(){}),d.scrollTop=0});var u=n.get("#J_justar");if(u){var f,p="#J_justar i",g=!1,v=!1;i.on(u,"mouseenter",function(t){g||(a.isLogin()?(n.addClass(p,"loginin"),f=setTimeout(function(){g||s(t,function(){window.goldlog&&window.goldlog.send("//gm.mmstat.com/jhs.4.3.8?name=icon&page="+c.page)})},350)):(f=setTimeout(function(){g||n.addClass(u,"justara_on")},350),n.removeClass(p,"loginin")))}),i.on(u,"mouseleave",function(t){g||(clearTimeout(f),n.removeClass(u,"justara_on"))}),i.on(u,"click",function(t){if(t.preventDefault(),a.isLogin()){if(g)return;s(t,function(){window.goldlog&&window.goldlog.send("//gm.mmstat.com/jhs.4.3.8?name=icon&page="+c.page)})}else{if(n.removeClass(p,"loginin"),g)return;a.login(function(){e.getCollectMark(),s(t,function(){window.goldlog&&window.goldlog.send("//gm.mmstat.com/jhs.4.3.8?name=login&type=1&page="+c.page)})}),window.goldlog&&window.goldlog.send("//gm.mmstat.com/jhs.4.3.8?name=login&type=0&page="+c.page),window.goldlog&&window.goldlog.send("//gm.mmstat.com/jhs.4.3.8?name=icon&page="+c.page)}}),i.on(document,"click",function(a){a.stopPropagation(),t.all(a.target).parent("#J_favboxparent")||l()})}},this._render=function(){var t=this;this.trigger||this._rendTrigger(),this._bindEvent(),i.on(window,"scroll",function(a){t.timer||(t._checkToShow(),t.timer=setTimeout(function(){clearTimeout(t.timer),t.timer=null},t.config.interval))}),t._checkToShow()},this.addData=function(){e.addData.apply(null,arguments)}};return new n},{requires:["jbc/julogin","./../mods/favbox","core"]}),KISSY.config("modules",{"jbc/index":{requires:["./mods/jutools","./jufav.css","core"]},"jbc/mods/favbox":{requires:["gallery/kscroll/1.2/index","gallery/RichDate/1.0/index","jbc/julogin","jbc/jupopup","core"]},"jbc/mods/jutools":{requires:["jbc/julogin","./../mods/favbox","core"]}});