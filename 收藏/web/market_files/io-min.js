/*
Copyright 2013, KISSY v1.40
MIT Licensed
build time: Nov 13 21:48
*/
KISSY.add("io/form-serializer",function(c,f){function j(b){return b.replace(i,"\r\n")}var l=/^(?:select|textarea)/i,i=/\r?\n/g,h,b=/^(?:color|date|datetime|email|hidden|month|number|password|range|search|tel|text|time|url|week)$/i;return h={serialize:function(b,a){return c.param(h.getFormData(b),void 0,void 0,a||!1)},getFormData:function(d){var a=[],k={};c.each(f.query(d),function(b){b=b.elements?c.makeArray(b.elements):[b];a.push.apply(a,b)});a=c.filter(a,function(a){return a.name&&!a.disabled&&
(a.checked||l.test(a.nodeName)||b.test(a.type))});c.each(a,function(b){var a=f.val(b),e;null!==a&&(a=c.isArray(a)?c.map(a,j):j(a),(e=k[b.name])?(e&&!c.isArray(e)&&(e=k[b.name]=[e]),e.push.apply(e,c.makeArray(a))):k[b.name]=a)});return k}}},{requires:["dom"]});
KISSY.add("io/base",function(c,f,j,l){function i(a){var b=a.context;delete a.context;a=c.mix(c.clone(e),a,{deep:!0});a.context=b||a;var g,h=a.type,f=a.dataType,b=a.uri=s.resolve(a.url);a.uri.setQuery("");"crossDomain"in a||(a.crossDomain=!a.uri.isSameOriginAs(s));h=a.type=h.toUpperCase();a.hasContent=!k.test(h);if(a.processData&&(g=a.data)&&"string"!=typeof g)a.data=c.param(g,l,l,a.serializeArray);f=a.dataType=c.trim(f||"*").split(d);!("cache"in a)&&c.inArray(f[0],["script","jsonp"])&&(a.cache=!1);
a.hasContent||(a.data&&b.query.add(c.unparam(a.data)),!1===a.cache&&b.query.set("_ksTS",c.now()+"_"+c.guid()));return a}function h(a){var b=this;if(!(b instanceof h))return new h(a);j.call(b);a=i(a);c.mix(b,{responseData:null,config:a||{},timeoutTimer:null,responseText:null,responseXML:null,responseHeadersString:"",responseHeaders:null,requestHeaders:{},readyState:0,state:0,statusText:null,status:0,transport:null});j.Defer(b);var e;h.fire("start",{ajaxConfig:a,io:b});e=new (g[a.dataType[0]]||g["*"])(b);
b.transport=e;a.contentType&&b.setRequestHeader("Content-Type",a.contentType);var d=a.dataType[0],s,k=a.timeout,f=a.context,l=a.headers,o=a.accepts;b.setRequestHeader("Accept",d&&o[d]?o[d]+("*"===d?"":", */*; q=0.01"):o["*"]);for(s in l)b.setRequestHeader(s,l[s]);if(a.beforeSend&&!1===a.beforeSend.call(f,b,a))return b;b.readyState=1;h.fire("send",{ajaxConfig:a,io:b});a.async&&0<k&&(b.timeoutTimer=setTimeout(function(){b.abort("timeout")},1E3*k));try{b.state=1,e.send()}catch(q){2>b.state?(q.stack||
q,"error",setTimeout(function(){throw q;},0),b._ioReady(-1,q.message)):q}return b}var b=/^(?:about|app|app\-storage|.+\-extension|file|widget)$/,d=/\s+/,a=function(a){return a},k=/^(?:GET|HEAD)$/,s=new c.Uri((c.Env.host.location||{}).href),b=s&&b.test(s.getScheme()),g={},e={type:"GET",contentType:"application/x-www-form-urlencoded; charset=UTF-8",async:!0,serializeArray:!0,processData:!0,accepts:{xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript",
"*":"*/*"},converters:{text:{json:c.parseJson,html:a,text:a,xml:c.parseXML}},headers:{"X-Requested-With":"XMLHttpRequest"},contents:{xml:/xml/,html:/html/,json:/json/}};e.converters.html=e.converters.text;c.mix(h,f.targetObject);c.mix(h,{isLocal:b,setupConfig:function(a){c.mix(e,a,{deep:!0})},setupTransport:function(a,b){g[a]=b},getTransport:function(a){return g[a]},getConfig:function(){return e}});return h},{requires:["event/custom","promise"]});
KISSY.add("io/xhr-transport-base",function(c,f){function j(a,b){try{return new (b||i).XMLHttpRequest}catch(e){}}function l(a){var b;a.ifModified&&(b=a.uri,!1===a.cache&&(b=b.clone(),b.query.remove("_ksTS")),b=b.toString());return b}var i=c.Env.host,h=7<c.UA.ie&&i.XDomainRequest,b={proto:{}},d={},a={};f.__lastModifiedCached=d;f.__eTagCached=a;b.nativeXhr=i.ActiveXObject?function(a,b){var e;if(!k&&a&&h)e=new h;else if(!(e=!f.isLocal&&j(a,b)))a:{try{e=new (b||i).ActiveXObject("Microsoft.XMLHTTP");break a}catch(d){}e=
void 0}return e}:j;b._XDomainRequest=h;var k=b.supportCORS="withCredentials"in b.nativeXhr();c.mix(b.proto,{sendInternal:function(){var b=this,g=b.io,e=g.config,m=b.nativeXhr,f=e.files,j=f?"post":e.type,i=e.async,n,w=g.mimeType,u=g.requestHeaders||{},g=g._getUrlForSend(),p;p=l(e);var o,q;if(p){if(o=d[p])u["If-Modified-Since"]=o;if(o=a[p])u["If-None-Match"]=o}p=e.xhrFields||{};"withCredentials"in p&&(k||delete p.withCredentials);(n=e.username)?m.open(j,g,i,n,e.password):m.open(j,g,i);for(q in p)try{m[q]=
p[q]}catch(x){x}w&&m.overrideMimeType&&m.overrideMimeType(w);!1===u["X-Requested-With"]&&delete u["X-Requested-With"];if("undefined"!==typeof m.setRequestHeader)for(q in u)m.setRequestHeader(q,u[q]);var v=e.hasContent&&e.data||null;f&&(j=v,n={},j&&(n=c.unparam(j)),n=c.mix(n,f),v=new FormData,c.each(n,function(a,b){c.isArray(a)?c.each(a,function(a){v.append(b+(e.serializeArray?"[]":""),a)}):v.append(b,a)}));m.send(v);!i||4==m.readyState?b._callback():h&&m instanceof h?(m.onload=function(){m.readyState=
4;m.status=200;b._callback()},m.onerror=function(){m.readyState=4;m.status=500;b._callback()}):m.onreadystatechange=function(){b._callback()}},abort:function(){this._callback(0,1)},_callback:function(b,g){var e=this.nativeXhr,k=this.io,j,i,r,n,w,u=k.config;try{if(g||4==e.readyState)if(h&&e instanceof h?(e.onerror=c.noop,e.onload=c.noop):e.onreadystatechange=c.noop,g)4!==e.readyState&&e.abort();else{j=l(u);var p=e.status;h&&e instanceof h||(k.responseHeadersString=e.getAllResponseHeaders());j&&(i=
e.getResponseHeader("Last-Modified"),r=e.getResponseHeader("ETag"),i&&(d[j]=i),r&&(a[r]=r));if((w=e.responseXML)&&w.documentElement)k.responseXML=w;var o=k.responseText=e.responseText;if(u.files&&o){var q,x;if(-1!=(q=o.indexOf("<body>")))x=o.lastIndexOf("</body>"),-1==x&&(x=o.length),o=o.slice(q+6,x);k.responseText=c.unEscapeHtml(o)}try{n=e.statusText}catch(v){"xhr statusText error: ",v,n=""}!p&&f.isLocal&&!u.crossDomain?p=k.responseText?200:404:1223===p&&(p=204);k._ioReady(p,n)}}catch(y){y.stack||
y,"error",setTimeout(function(){throw y;},0),e.onreadystatechange=c.noop,g||k._ioReady(-1,y)}}});return b},{requires:["./base"]});
KISSY.add("io/sub-domain-transport",function(c,f,j,l){function i(a){var b=a.config;this.io=a;b.crossDomain=!1;"use SubDomainTransport for: "+b.url}function h(){var a=this.io.config.uri.getHostname(),a=d[a];a.ready=1;j.detach(a.iframe,"load",h,this);this.send()}var b=c.Env.host.document,d={};c.augment(i,f.proto,{send:function(){var a=this.io.config,k=a.uri,s=k.getHostname(),g;g=d[s];var e="/sub_domain_proxy.html";a.xdr&&a.xdr.subDomain&&a.xdr.subDomain.proxy&&(e=a.xdr.subDomain.proxy);g&&g.ready?(this.nativeXhr=
f.nativeXhr(0,g.iframe.contentWindow))?this.sendInternal():"document.domain not set correctly!":(g?a=g.iframe:(g=d[s]={},a=g.iframe=b.createElement("iframe"),l.css(a,{position:"absolute",left:"-9999px",top:"-9999px"}),l.prepend(a,b.body||b.documentElement),g=new c.Uri,g.setScheme(k.getScheme()),g.setPort(k.getPort()),g.setHostname(s),g.setPath(e),a.src=g.toString()),j.on(a,"load",h,this))}});return i},{requires:["./xhr-transport-base","event","dom"]});
KISSY.add("io/xdr-flash-transport",function(c,f,j){function l(d,g,e){k||(k=!0,d='<object id="'+b+'" type="application/x-shockwave-flash" data="'+d+'" width="0" height="0"><param name="movie" value="'+d+'" /><param name="FlashVars" value="yid='+g+"&uid="+e+'&host=KISSY.IO" /><param name="allowScriptAccess" value="always" /></object>',g=a.createElement("div"),j.prepend(g,a.body||a.documentElement),g.innerHTML=d)}function i(a){"use XdrFlashTransport for: "+a.config.url;this.io=a}var h={},b="io_swf",
d,a=c.Env.host.document,k=!1;c.augment(i,{send:function(){var a=this,b=a.io,e=b.config;l((e.xdr||{}).src||c.Config.base+"io/assets/io.swf",1,1);d?(a._uid=c.guid(),h[a._uid]=a,d.send(b._getUrlForSend(),{id:a._uid,uid:a._uid,method:e.type,data:e.hasContent&&e.data||{}})):setTimeout(function(){a.send()},200)},abort:function(){d.abort(this._uid)},_xdrResponse:function(a,b){var e,d=b.id,k,c=b.c,f=this.io;if(c&&(k=c.responseText))f.responseText=decodeURI(k);switch(a){case "success":e={status:200,statusText:"success"};
delete h[d];break;case "abort":delete h[d];break;case "timeout":case "transport error":case "failure":delete h[d],e={status:"status"in c?c.status:500,statusText:c.statusText||a}}e&&f._ioReady(e.status,e.statusText)}});f.applyTo=function(a,b,e){var a=b.split(".").slice(1),d=f;c.each(a,function(a){d=d[a]});d.apply(null,e)};f.xdrReady=function(){d=a.getElementById(b)};f.xdrResponse=function(a,b){var d=h[b.uid];d&&d._xdrResponse(a,b)};return i},{requires:["./base","dom"]});
KISSY.add("io/xhr-transport",function(c,f,j,l,i){function h(a){var k=a.config,f=k.crossDomain,g=k.xdr||{},e=g.subDomain=g.subDomain||{};this.io=a;if(f&&!j.supportCORS){var h=k.uri.getHostname();if(b.domain&&c.endsWith(h,b.domain)&&!1!==e.proxy)return new l(a);if("flash"===""+g.use||!d)return new i(a)}a=this.nativeXhr=j.nativeXhr(f);"crossDomain: "+f+", use "+(d&&a instanceof d?"XDomainRequest":"XhrTransport")+" for: "+k.url;return this}var b=c.Env.host.document,d=j._XDomainRequest;c.augment(h,j.proto,
{send:function(){this.sendInternal()}});f.setupTransport("*",h);return f},{requires:["./base","./xhr-transport-base","./sub-domain-transport","./xdr-flash-transport"]});
KISSY.add("io/script-transport",function(c,f,j,l){function i(b){var a=b.config;if(!a.crossDomain)return new (f.getTransport("*"))(b);this.io=b;"use ScriptTransport for: "+a.url;return this}var h=c.Env.host,b=h.document;f.setupConfig({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/javascript|ecmascript/},converters:{text:{script:function(b){c.globalEval(b);return b}}}});c.augment(i,{send:function(){var d=this,a,k=d.io,
c=k.config,g=b.head||b.getElementsByTagName("head")[0]||b.documentElement;d.head=g;a=b.createElement("script");d.script=a;a.async=!0;c.scriptCharset&&(a.charset=c.scriptCharset);a.src=k._getUrlForSend();a.onerror=a.onload=a.onreadystatechange=function(a){a=a||h.event;d._callback((a.type||"error").toLowerCase())};g.insertBefore(a,g.firstChild)},_callback:function(b,a){var k=this.script,c=this.io,g=this.head;if(k&&(a||!k.readyState||/loaded|complete/.test(k.readyState)||"error"==b))k.onerror=k.onload=
k.onreadystatechange=null,g&&k.parentNode&&g.removeChild(k),this.head=this.script=l,!a&&"error"!=b?c._ioReady(200,"success"):"error"==b&&c._ioReady(500,"script error")},abort:function(){this._callback(0,1)}});f.setupTransport("script",i);return f},{requires:["./base","./xhr-transport"]});
KISSY.add("io/jsonp",function(c,f){var j=c.Env.host;f.setupConfig({jsonp:"callback",jsonpCallback:function(){return c.guid("jsonp")}});f.on("start",function(f){var i=f.io,h=i.config,f=h.dataType;if("jsonp"==f[0]){delete h.contentType;var b,d=h.jsonpCallback,a="function"===typeof d?d():d,k=j[a];h.uri.query.set(h.jsonp,a);j[a]=function(a){1<arguments.length&&(a=c.makeArray(arguments));b=[a]};i.fin(function(){j[a]=k;if(void 0===k)try{delete j[a]}catch(d){}else b&&k(b[0])});i=h.converters;i.script=i.script||
{};i.script.json=function(){b||" not call jsonpCallback: "+a;return b[0]};f.length=2;f[0]="script";f[1]="json"}});return f},{requires:["./base"]});
KISSY.add("io/form",function(c,f,j,l){var i=Array.prototype.slice,h=c.Env.host.FormData;f.on("start",function(b){var d,a,b=b.io.config;if(a=b.form){d=j.get(a);a=b.data;for(var k=!1,f={},g=j.query("input",d),e=0,m=g.length;e<m;e++){var z=g[e];if("file"==z.type.toLowerCase()){k=!0;if(!h)break;var t=i.call(z.files,0);f[j.attr(z,"name")]=1<t.length?t:t[0]||null}}k&&h&&(b.files=b.files||{},c.mix(b.files,f),delete b.contentType);!k||h?(d=l.getFormData(d),b.hasContent?(d=c.param(d,void 0,void 0,b.serializeArray),
b.data=a?b.data+("&"+d):d):b.uri.query.add(d)):(a=b.dataType,b=a[0],"*"==b&&(b="text"),a.length=2,a[0]="iframe",a[1]=b)}});return f},{requires:["./base","dom","./form-serializer"]});
KISSY.add("io/iframe-transport",function(c,f,j,l){function i(a){var b=c.guid("io-iframe"),g=f.getEmptyIframeSrc(),a=a.iframe=f.create("<iframe "+(g?' src="'+g+'" ':"")+' id="'+b+'" name="'+b+'" style="position:absolute;left:-9999px;top:-9999px;"/>');f.prepend(a,d.body||d.documentElement);return a}function h(a,b,g){var e=[],h,j,i,l;c.each(a,function(a,k){h=c.isArray(a);j=c.makeArray(a);for(i=0;i<j.length;i++)l=d.createElement("input"),l.type="hidden",l.name=k+(h&&g?"[]":""),l.value=j[i],f.append(l,
b),e.push(l)});return e}function b(a){this.io=a;"use IframeTransport for: "+a.config.url}var d=c.Env.host.document,a=c.clone(l.getConfig().converters.text);a.json=function(a){return c.parseJson(c.unEscapeHtml(a))};l.setupConfig({converters:{iframe:a,text:{iframe:function(a){return a}},xml:{iframe:function(a){return a}}}});c.augment(b,{send:function(){function a(){j.on(l,"load error",b._callback,b);n.submit()}var b=this,d=b.io,e=d.config,m,l,t,r=e.data,n=f.get(e.form);b.attrs={target:f.attr(n,"target")||
"",action:f.attr(n,"action")||"",encoding:f.attr(n,"encoding"),enctype:f.attr(n,"enctype"),method:f.attr(n,"method")};b.form=n;l=i(d);f.attr(n,{target:l.id,action:d._getUrlForSend(),method:"post",enctype:"multipart/form-data",encoding:"multipart/form-data"});r&&(t=c.unparam(r));t&&(m=h(t,n,e.serializeArray));b.fields=m;6==c.UA.ie?setTimeout(a,0):a()},_callback:function(a){var b=this,d=b.form,e=b.io,a=a.type,h,i=e.iframe;if(i)if("abort"==a&&6==c.UA.ie?setTimeout(function(){f.attr(d,b.attrs)},0):f.attr(d,
b.attrs),f.remove(this.fields),j.detach(i),setTimeout(function(){f.remove(i)},30),e.iframe=null,"load"==a)try{if((h=i.contentWindow.document)&&h.body)e.responseText=f.html(h.body),c.startsWith(e.responseText,"<?xml")&&(e.responseText=void 0);e.responseXML=h&&h.XMLDocument?h.XMLDocument:h;h?e._ioReady(200,"success"):e._ioReady(500,"parser error")}catch(l){e._ioReady(500,"parser error")}else"error"==a&&e._ioReady(500,"error")},abort:function(){this._callback({type:"abort"})}});l.setupTransport("iframe",
b);return l},{requires:["dom","event","./base"]});
KISSY.add("io/methods",function(c,f,j,l){function i(b){var d=b.responseText,a=b.responseXML,f=b.config,h=f.converters,g,e,j=f.contents,i=f.dataType;if(d||a){for(f=b.mimeType||b.getResponseHeader("Content-Type");"*"==i[0];)i.shift();if(!i.length)for(g in j)if(j[g].test(f)){i[0]!=g&&i.unshift(g);break}i[0]=i[0]||"text";for(g=0;g<i.length;g++)if("text"==i[g]&&d!==l){e=d;break}else if("xml"==i[g]&&a!==l){e=a;break}if(!e){var t={text:d,xml:a};c.each(["text","xml"],function(b){var c=i[0];return h[b]&&h[b][c]&&
t[b]?(i.unshift(b),e="text"==b?d:a,!1):l})}}j=i[0];for(f=1;f<i.length;f++){g=i[f];var r=h[j]&&h[j][g];if(!r)throw"no covert for "+j+" => "+g;e=r(e);j=g}b.responseData=e}var h=/^(.*?):[ \t]*([^\r\n]*)\r?$/mg;c.extend(f,j,{setRequestHeader:function(b,d){this.requestHeaders[b]=d;return this},getAllResponseHeaders:function(){return 2===this.state?this.responseHeadersString:null},getResponseHeader:function(b){var d,a;if(2===this.state){if(!(a=this.responseHeaders))for(a=this.responseHeaders={};d=h.exec(this.responseHeadersString);)a[d[1]]=
d[2];d=a[b]}return d===l?null:d},overrideMimeType:function(b){this.state||(this.mimeType=b);return this},abort:function(b){b=b||"abort";this.transport&&this.transport.abort(b);this._ioReady(0,b);return this},getNativeXhr:function(){var b;return(b=this.transport)?b.nativeXhr:null},_ioReady:function(b,d){if(2!=this.state){this.state=2;this.readyState=4;var a;if(200<=b&&300>b||304==b)if(304==b)d="not modified",a=!0;else try{i(this),d="success",a=!0}catch(c){c.stack||c,"error",setTimeout(function(){throw c;
},0),d="parser error"}else 0>b&&(b=0);this.status=b;this.statusText=d;var h=this.defer,g=this.config,e;if(e=this.timeoutTimer)clearTimeout(e),this.timeoutTimer=0;e=a?"success":"error";var j,l=[this.responseData,d,this],t=g.context,r={ajaxConfig:g,io:this};(j=g[e])&&j.apply(t,l);(j=g.complete)&&j.apply(t,l);f.fire(e,r);f.fire("complete",r);h[a?"resolve":"reject"](l)}},_getUrlForSend:function(){var b=this.config,d=b.uri,a=c.Uri.getComponents(b.url).query||"";return d.toString.call(d,b.serializeArray)+
(a?(d.query.has()?"&":"?")+a:a)}})},{requires:["./base","promise"]});
KISSY.add("io",function(c,f,j){function l(c,b,d,a,f){"function"===typeof b&&(a=d,d=b,b=i);return j({type:f||"get",url:c,data:b,success:d,dataType:a})}var i=void 0;c.mix(j,{serialize:f.serialize,get:l,post:function(c,b,d,a){"function"===typeof b&&(a=d,d=b,b=i);return l(c,b,d,a,"post")},jsonp:function(c,b,d){"function"===typeof b&&(d=b,b=i);return l(c,b,d,"jsonp")},getScript:c.getScript,getJSON:function(c,b,d){"function"===typeof b&&(d=b,b=i);return l(c,b,d,"json")},upload:function(c,b,d,a,f){"function"===
typeof d&&(f=a,a=d,d=i);return j({url:c,type:"post",dataType:f,form:b,data:d,success:a})}});c.mix(c,{Ajax:j,IO:j,ajax:j,io:j,jsonp:j.jsonp});return j},{requires:"io/form-serializer,io/base,io/xhr-transport,io/script-transport,io/jsonp,io/form,io/iframe-transport,io/methods".split(",")});
