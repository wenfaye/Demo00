define("event-dom-base",["dom","event-base","util"],function(e){var t,r,n,o,a,i,l,c,u,s=e("dom"),f=e("event-base"),v=e("util");return t=function(e){var t=s,r="ksEventTargetId_"+ +new Date,n=document,o=n&&n.addEventListener?function(e,t,r,n){e.addEventListener&&e.addEventListener(t,r,!!n)}:function(e,t,r){e.attachEvent&&e.attachEvent("on"+t,r)},a=n&&n.removeEventListener?function(e,t,r,n){e.removeEventListener&&e.removeEventListener(t,r,!!n)}:function(e,t,r){e.detachEvent&&e.detachEvent("on"+t,r)};return e={simpleAdd:o,simpleRemove:a,data:function(e,n){return t.data(e,r,n)},removeData:function(e){return t.removeData(e,r)}}}(),r=function(e){return e={}}(),n=function(e){function t(e){t.superclass.constructor.call(this,e)}var n=f,o=r,a=v;return a.extend(t,n.Observer,{keys:["fn","filter","data","context","originalType","groups","last"],notifyInternal:function(e,t){var r,n,a,i,l=this,c=e.type;return(i=l.config.originalType)?e.type=i:i=c,(r=o[i])&&r.handle?(n=r.handle(e,l,t),n&&n.length>0&&(a=n[0])):a=l.simpleNotify(e,t),a===!1&&e.halt(),e.type=c,a}}),e=t}(),o=function(e){function t(){return l}function r(){return c}function n(e){var o=this,l=e.type,f="function"==typeof e.stopPropagation||"boolean"==typeof e.cancelBubble;n.superclass.constructor.call(o),o.originalEvent=e;var v=r;"defaultPrevented"in e?v=e.defaultPrevented?t:r:"getPreventDefault"in e?v=e.getPreventDefault()?t:r:"returnValue"in e&&(v=e.returnValue===c?t:r),o.isDefaultPrevented=v;var d,g,p,h=[],m=u.concat();for(a.each(s,function(e){return l.match(e.reg)&&(m=m.concat(e.props),e.fix&&h.push(e.fix)),void 0}),g=m.length;g;)p=m[--g],o[p]=e[p];for(!o.target&&f&&(o.target=e.srcElement||i),o.target&&3===o.target.nodeType&&(o.target=o.target.parentNode),g=h.length;g;)d=h[--g],d(o,e);o.timeStamp=e.timeStamp||a.now()}var o=f,a=v,i=document,l=!0,c=!1,u=["altKey","bubbles","cancelable","ctrlKey","currentTarget","eventPhase","metaKey","shiftKey","target","timeStamp","view","type"],s=[{reg:/^key/,props:["char","charCode","key","keyCode","which"],fix:function(e,t){null==e.which&&(e.which=null!=t.charCode?t.charCode:t.keyCode),void 0===e.metaKey&&(e.metaKey=e.ctrlKey)}},{reg:/^touch/,props:["touches","changedTouches","targetTouches"]},{reg:/^hashchange$/,props:["newURL","oldURL"]},{reg:/^gesturechange$/i,props:["rotation","scale"]},{reg:/^(mousewheel|DOMMouseScroll)$/,props:[],fix:function(e,t){var r,n,o,a=t.wheelDelta,i=t.axis,l=t.wheelDeltaY,c=t.wheelDeltaX,u=t.detail;a&&(o=a/120),u&&(o=0-(u%3===0?u/3:u)),void 0!==i&&(i===e.HORIZONTAL_AXIS?(n=0,r=0-o):i===e.VERTICAL_AXIS&&(r=0,n=o)),void 0!==l&&(n=l/120),void 0!==c&&(r=-1*c/120),r||n||(n=o),void 0!==r&&(e.deltaX=r),void 0!==n&&(e.deltaY=n),void 0!==o&&(e.delta=o)}},{reg:/^mouse|contextmenu|click|mspointer|(^DOMMouseScroll$)/i,props:["buttons","clientX","clientY","button","offsetX","relatedTarget","which","fromElement","toElement","offsetY","pageX","pageY","screenX","screenY"],fix:function(e,t){var r,n,o,a=e.target,l=t.button;return a&&null==e.pageX&&null!=t.clientX&&(r=a.ownerDocument||i,n=r.documentElement,o=r.body,e.pageX=t.clientX+(n&&n.scrollLeft||o&&o.scrollLeft||0)-(n&&n.clientLeft||o&&o.clientLeft||0),e.pageY=t.clientY+(n&&n.scrollTop||o&&o.scrollTop||0)-(n&&n.clientTop||o&&o.clientTop||0)),e.which||void 0===l||(e.which=1&l?1:2&l?3:4&l?2:0),!e.relatedTarget&&e.fromElement&&(e.relatedTarget=e.fromElement===a?e.toElement:e.fromElement),e}}];return a.extend(n,o.Object,{constructor:n,preventDefault:function(){var e=this,t=e.originalEvent;t.preventDefault?t.preventDefault():t.returnValue=c,n.superclass.preventDefault.call(e)},stopPropagation:function(){var e=this,t=e.originalEvent;t.stopPropagation?t.stopPropagation():t.cancelBubble=l,n.superclass.stopPropagation.call(e)}}),e=n}(),a=function(e){function a(e){var t=this;i.mix(t,e),t.reset()}var i=v,l=f,c=s,u=r,d=t,g=n,p=o,h=l.Utils;return i.extend(a,l.Observable,{constructor:a,setup:function(){var e=this,t=e.type,r=u[t]||{},n=e.currentTarget,o=d.data(n),a=o.handle;r.setup&&r.setup.call(n,t)!==!1||d.simpleAdd(n,t,a)},reset:function(){var e=this;a.superclass.reset.call(e),e.delegateCount=0,e.lastCount=0},notify:function(e){var t,r,n,o,a,i,l,u,s,f,v=e.target,d=e.type,g=this,p=g.currentTarget,h=g.observers,m=[],b=g.delegateCount||0;if(b&&v.nodeType)for(;v!==p;){if(v.disabled!==!0||"click"!==d){var y,E,T,D={};for(u=[],a=0;b>a;a++)f=h[a],T=f.config.filter,E=T+"",y=D[E],void 0===y&&(y=D[E]=c.test(v,T)),y&&u.push(f);u.length&&m.push({currentTarget:v,currentTargetObservers:u})}v=v.parentNode||p}for(b<h.length&&m.push({currentTarget:p,currentTargetObservers:h.slice(b)}),a=0,l=m.length;!e.isPropagationStopped()&&l>a;++a)for(o=m[a],u=o.currentTargetObservers,t=o.currentTarget,e.currentTarget=t,i=0;!e.isImmediatePropagationStopped()&&i<u.length;i++)s=u[i],r=s.notify(e,g),n!==!1&&void 0!==r&&(n=r);return n},fire:function(e,t){e=e||{};var r,n,o=this,l=String(o.type),s=u[l]||{},f=s.bubbles!==!1,v=o.currentTarget;if(!(s.fire&&s.fire.call(v,t)===!1||(e.isEventObject||(n=e,e=new p({type:l}),i.mix(e,n)),e.currentTarget=v,e.target=e.target||v,s.preFire&&s.preFire.call(v,e,t)===!1))){var d,g,h=v,m=c.getWindow(h),b=m.document,y=[],E="on"+l,T=0;do y.push(h),h=h.parentNode||h.ownerDocument||h===b&&m;while(!t&&h&&f);h=y[T];do e.currentTarget=h,r=a.getDomEventObservable(h,l),r&&(g=r.notify(e),void 0!==g&&d!==!1&&(d=g)),h[E]&&h[E].call(h)===!1&&e.preventDefault(),h=y[++T];while(!t&&h&&!e.isPropagationStopped());if(!t&&!e.isDefaultPrevented()){try{v[l]&&!i.isWindow(v)&&(a.triggeredEvent=l,v[l]())}catch(D){console.error("event-dom: trigger action error: "+D)}a.triggeredEvent=""}return d}},on:function(e){var t=this,r=t.observers,n=u[t.type]||{},o=e instanceof g?e:new g(e);-1===t.findObserver(o)&&(o.config.filter?(r.splice(t.delegateCount,0,o),t.delegateCount++):o.config.last?(r.push(o),t.lastCount++):r.splice(r.length-t.lastCount,0,o),n.add&&n.add.call(t.currentTarget,o))},detach:function(e){var t,r=this,n=u[r.type]||{},o="filter"in e,a=e.filter,i=e.context,l=e.fn,c=r.currentTarget,s=r.observers,f=e.groups;if(s.length){f&&(t=h.getGroupsRe(f));var v,d,g,p,m,b=s.length;if(l||o||t){for(i=i||c,v=0,d=0,g=[];b>v;++v){p=s[v];var y=p.config;m=y.context||c,i!==m||l&&l!==y.fn||o&&(a&&a!==y.filter||!a&&!y.filter)||t&&!y.groups.match(t)?g[d++]=p:(y.filter&&r.delegateCount&&r.delegateCount--,y.last&&r.lastCount&&r.lastCount--,n.remove&&n.remove.call(c,p))}r.observers=g}else r.reset();r.checkMemory()}},checkMemory:function(){var e,t,r=this,n=r.type,o=u[n]||{},a=r.currentTarget,l=d.data(a);l&&(e=l.observables,r.hasObserver()||(t=l.handle,o.tearDown&&o.tearDown.call(a,n)!==!1||d.simpleRemove(a,n,t),delete e[n]),i.isEmptyObject(e)&&(l.handle=null,d.removeData(a)))}}),a.triggeredEvent="",a.getDomEventObservable=function(e,t){var r,n=d.data(e);return n&&(r=n.observables),r?r[t]:null},a.getDomEventObservablesHolder=function(e,t){var r=d.data(e);return!r&&t&&d.data(e,r={}),r},e=a}(),i=function(e){function n(e,t){var r,n=g[t]||{};return!e.originalType&&(r=n.typeFix)&&(e.originalType=t,t=r),t}function i(e,t,r){var o,a,i,l;r=m.merge(r),t=n(r,t),o=p.getDomEventObservablesHolder(e,1),(l=o.handle)||(l=o.handle=function(e){var t,r=e.type,n=l.currentTarget;return p.triggeredEvent===r?void 0:(t=p.getDomEventObservable(n,r),t?(e.currentTarget=n,e=new h(e),t.notify(e)):void 0)},l.currentTarget=e),(i=o.observables)||(i=o.observables={}),a=i[t],a||(a=i[t]=new p({type:t,currentTarget:e}),a.setup()),a.on(r),e=null}function l(e,t,r){r=m.merge(r);var o;t=n(r,t);var a=p.getDomEventObservablesHolder(e),i=(a||{}).observables;if(a&&i)if(t)o=i[t],o&&o.detach(r);else for(t in i)i[t].detach(r)}var c=f,u=t,d=s,g=r,p=a,h=o,m=v,b=c.Utils,y={on:function(e,t,r,n){return e=d.query(e),b.batchForType(function(e,t,r,n){var o,a,l=b.normalizeParam(t,r,n);for(t=l.type,o=e.length-1;o>=0;o--)a=e[o],i(a,t,l)},1,e,t,r,n),e},detach:function(e,t,r,n){return e=d.query(e),b.batchForType(function(e,t,r,n){var o,a,i,c,u=b.normalizeParam(t,r,n);for(t=u.type,o=e.length-1;o>=0;o--)if(c=e[o],l(c,t,u),u.deep&&c.getElementsByTagName)for(i=c.getElementsByTagName("*"),a=i.length-1;a>=0;a--)l(i[a],t,u)},1,e,t,r,n),e},delegate:function(e,t,r,n,o){return y.on(e,t,{fn:n,context:o,filter:r})},undelegate:function(e,t,r,n,o){return y.detach(e,t,{fn:n,context:o,filter:r})},fire:function(e,t,r,n){var o;return t.isEventObject&&(r=t,t=t.type),r=r||{},r.synthetic=1,b.splitAndRun(t,function(t){var a,i,l,c;b.fillGroupsForEvent(t,r),t=r.type;var u=g[t],s=t;for(u&&u.typeFix&&(s=u.typeFix),e=d.query(e),i=e.length-1;i>=0;i--)l=e[i],c=p.getDomEventObservable(l,s),n||c||(c=new p({type:s,currentTarget:l})),c&&(a=c.fire(r,n),o!==!1&&void 0!==a&&(o=a))}),o},fireHandler:function(e,t,r){return y.fire(e,t,r,1)},clone:function(e,t){var r,n;if(r=p.getDomEventObservablesHolder(e)){var o=u.data(e);o&&o===u.data(t)&&u.removeData(t),n=r.observables,m.each(n,function(e,r){m.each(e.observers,function(e){i(t,r,e.config)})})}},getEventListeners:function(e,t){var r=(p.getDomEventObservablesHolder(e)||{observables:{}}).observables;return t?r[t]:r}};return e=y}(),l=function(e){var t=i,n=r,o=v,a="onmousewheel"in document.documentElement?"mousewheel":"DOMMouseScroll";return e=o.mix(n,{mousewheel:{typeFix:a},load:{bubbles:!1},click:{fire:function(e){var t=this;return!e&&"checkbox"===String(t.type)&&t.click&&"input"===t.nodeName.toLowerCase()?(t.click(),!1):void 0}},focus:{bubbles:!1,preFire:function(e,r){return r?void 0:t.fire(this,"focusin")},fire:function(e){var t=this;return!e&&t.ownerDocument&&t!==t.ownerDocument.activeElement&&t.focus?(t.focus(),!1):void 0}},blur:{bubbles:!1,preFire:function(e,r){return r?void 0:t.fire(this,"focusout")},fire:function(e){var t=this;return!e&&t.ownerDocument&&t===t.ownerDocument.activeElement&&t.blur?(t.blur(),!1):void 0}}})}(),c=function(e){var r=v,n=i,c=o,u=a,s=l,f=t;return e=r.merge({add:n.on,remove:n.detach,off:n.detach,trigger:n.fire,triggerHandler:n.fireHandler,Observable:u,Special:s,Object:c,Utils:f},n)}(),u=function(e){return e=c}()});